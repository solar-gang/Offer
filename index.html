<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Leverage Our Sun • Solar + Storage Presentation</title>
  <meta name="description" content="TOU problem + real bills + Tesla VPP links + outage demo + 25-year comparison with a year-selection wheel (Price-is-Right style)." />

  <!--
    ✅ SINGLE FILE: index.html
    ✅ Uses YOUR assets (logo + bills) via GitHub RAW URLs
    ✅ iPhone-friendly: no input zoom, swipe table, tap-to-zoom bills, inline video

    CONFIRMED ASSETS:
    Logo:
    https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/4A5B0E0C-50D9-4752-8469-F61A667110D8.png

    Utility-only bill:
    https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_8578.jpeg

    Solar Net Billing bill:
    https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_9100.jpeg

    Your video filename:
    RecordIt-1770162136.mov
    (We attempt MOV + optional MP4 fallback—see settings)

    GitHub Pages:
    Repo → Settings → Pages → Deploy from branch → main → /(root)
  -->

  <style>
    :root{
      /* Night/base */
      --night:#06122a;
      --night2:#040b1c;
      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.56);
      --border: rgba(255,255,255,.14);
      --shadow: 0 18px 70px rgba(0,0,0,.48);

      /* Logo energy */
      --sun2:#ff7a00;
      --sun:#ffb000;
      --lime:#8cff3f;
      --cyan:#00c2ff;
      --bolt:#ffe94a;

      /* Semantics */
      --red:#ff3b30;
      --green:#34c759;
      --blue:#00c2ff;

      --r:18px;
      --r2:22px;

      --grad: linear-gradient(135deg, var(--sun2), var(--lime), var(--cyan));
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth; scroll-padding-top:96px;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 16% 10%, rgba(255,122,0,.22), transparent 58%),
        radial-gradient(900px 520px at 46% 40%, rgba(140,255,63,.10), transparent 58%),
        radial-gradient(900px 520px at 84% 12%, rgba(0,194,255,.20), transparent 55%),
        radial-gradient(1200px 700px at 55% 95%, rgba(255,233,74,.08), transparent 62%),
        linear-gradient(180deg, var(--night), var(--night2));
    }
    a{color:#cfe8ff;text-decoration:none}
    a:hover{text-decoration:underline}
    a, button { -webkit-tap-highlight-color: transparent; }

    /* Topbar */
    .topbar{
      position:fixed; inset:0 0 auto 0;
      background:rgba(4,10,22,.62);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom:1px solid rgba(255,255,255,.14);
      z-index:50;
      padding-top: env(safe-area-inset-top);
    }
    .topbar-inner{
      max-width:1200px;
      margin:0 auto;
      padding:12px 18px;
      padding-left: calc(18px + env(safe-area-inset-left));
      padding-right: calc(18px + env(safe-area-inset-right));
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:12px; min-width:280px;}
    .brand img{height:42px; width:auto; display:block;}
    .brandText{display:flex; flex-direction:column; line-height:1.15;}
    .brandTitle{font-weight:950; letter-spacing:-.02em; display:flex; align-items:center; gap:10px;}
    .brandGlow{
      width:10px;height:10px;border-radius:999px;
      background: var(--grad);
      box-shadow: 0 0 0 6px rgba(255,122,0,.10), 0 0 24px rgba(0,194,255,.26);
    }
    .brandSub{color:var(--muted2); font-size:12.5px; margin-top:2px;}
    .nav{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}

    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:12px 14px;
      border-radius: 12px;
      font-weight: 900;
      cursor:pointer;
      min-height:44px;
      line-height:1;
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
      touch-action: manipulation;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .btn:hover{background: rgba(255,255,255,.10); transform: translateY(-1px); box-shadow: 0 12px 40px rgba(0,0,0,.25);}
    .btn.primary{
      background: var(--grad);
      border-color: rgba(255,255,255,.18);
      color: #06101e;
      box-shadow: 0 14px 50px rgba(0,194,255,.12), 0 14px 50px rgba(255,122,0,.10);
    }

    .container{
      max-width:1200px;
      margin:0 auto;
      padding: calc(92px + env(safe-area-inset-top)) 18px calc(84px + env(safe-area-inset-bottom));
      padding-left: calc(18px + env(safe-area-inset-left));
      padding-right: calc(18px + env(safe-area-inset-right));
    }

    /* Hero */
    .hero{
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      padding:18px;
      display:grid;
      grid-template-columns: 1.25fr .9fr;
      gap:14px;
      overflow:hidden;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 300px at 20% 20%, rgba(255,122,0,.14), transparent 60%),
        radial-gradient(700px 300px at 80% 20%, rgba(0,194,255,.12), transparent 60%),
        radial-gradient(700px 300px at 55% 90%, rgba(140,255,63,.10), transparent 60%);
      pointer-events:none;
      filter: blur(2px);
    }
    .hero > *{position:relative; z-index:1;}
    h1{margin:0; font-size: clamp(22px, 3.2vw, 36px); letter-spacing:-.035em; line-height:1.08;}
    .gradText{background: var(--grad); -webkit-background-clip:text; background-clip:text; color:transparent; font-weight:1000;}
    .hero p{margin:10px 0 0; color:var(--muted); line-height:1.45; max-width: 820px;}

    .pills{margin-top:14px; display:flex; flex-wrap:wrap; gap:10px;}
    .pill{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding:8px 10px;
      border-radius: 999px;
      color: var(--muted);
      font-size: 13px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill .dot{width:8px;height:8px;border-radius:999px;background: var(--grad); box-shadow: 0 0 18px rgba(0,194,255,.22);}
    .heroActions{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;}
    .note{
      margin-top:14px;
      color: var(--muted2);
      font-size: 12.5px;
      border-left: 3px solid rgba(0,194,255,.55);
      padding-left: 10px;
      line-height: 1.45;
    }

    .card{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: var(--r);
      padding:14px;
      box-shadow: 0 12px 35px rgba(0,0,0,.25);
    }
    .fieldGrid{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    label span{
      display:block;
      color:var(--muted2);
      font-size:11.5px;
      letter-spacing:.06em;
      text-transform:uppercase;
      margin-bottom:6px;
    }
    input{
      width:100%;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: var(--text);
      font-weight: 900;
      outline:none;
      min-height:44px;
      font-size:16px; /* iPhone no-zoom */
    }
    input:focus{
      border-color: rgba(0,194,255,.65);
      box-shadow: 0 0 0 6px rgba(0,194,255,.14);
    }

    /* Sections */
    .section{
      margin-top: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
      scroll-margin-top: 96px;
    }
    .sectionHead{
      padding:16px 18px;
      border-bottom:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      display:flex;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      align-items:flex-start;
    }
    .sectionHead h2{margin:0; font-size:16px; display:flex; align-items:center; gap:10px;}
    .spark{
      width:10px;height:10px;border-radius:999px;
      background: var(--grad);
      box-shadow: 0 0 22px rgba(255,122,0,.18), 0 0 22px rgba(0,194,255,.16);
    }
    .sectionHead p{margin:6px 0 0; color:var(--muted); max-width:840px; font-size:13.5px; line-height:1.35;}
    .sectionBody{padding:18px;}

    .grid12{display:grid; grid-template-columns: repeat(12, 1fr); gap:14px;}
    .span5{grid-column: span 5;}
    .span6{grid-column: span 6;}
    .span7{grid-column: span 7;}
    .span12{grid-column: span 12;}

    .badgeRow{display:flex; gap:10px; flex-wrap:wrap;}
    .badge{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      border-radius:999px;
      padding:7px 10px;
      font-size: 12.5px;
      color: var(--muted);
      font-weight: 900;
    }
    .badge.problem{border-color: rgba(255,59,48,.40); background: rgba(255,59,48,.10);}
    .badge.solution{border-color: rgba(52,199,89,.40); background: rgba(52,199,89,.10);}
    .badge.energy{border-color: rgba(0,194,255,.35); background: rgba(0,194,255,.10);}

    .callout{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      border-radius: var(--r);
      padding:12px;
      line-height:1.4;
    }
    .callout h3{
      margin:0 0 8px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--muted);
    }
    .callout ul{margin:0; padding-left: 18px; color: rgba(255,255,255,.88);}
    .callout li{margin:8px 0;}

    /* Bills */
    figure.bill{
      margin:0;
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r);
      background: rgba(0,0,0,.20);
      overflow:hidden;
    }
    figure.bill img{
      width:100%;
      height:auto;
      display:block;
      cursor: zoom-in;
      background:#fff;
      -webkit-user-select:none;
      user-select:none;
    }
    .billCaption{
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.10);
      color: var(--muted2);
      font-size: 12.5px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .tag{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight:900;
      font-size: 12px;
    }
    .tag .mini{width:8px;height:8px;border-radius:999px;background: var(--grad);}

    /* Video */
    .videoWrap{
      border-radius: var(--r);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      box-shadow: 0 18px 70px rgba(0,0,0,.35);
    }
    video{width:100%; height:auto; display:block; background:#000;}
    .videoError{
      margin-top:12px;
      border:1px solid rgba(255,59,48,.30);
      background: rgba(255,59,48,.10);
      border-radius: var(--r);
      padding:12px;
      color: rgba(255,255,255,.90);
      display:none;
    }

    /* Calculator */
    .columns{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px;}
    .col{
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r);
      background: rgba(255,255,255,.04);
      overflow:hidden;
    }
    .colHead{
      padding:12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      background: rgba(255,255,255,.05);
    }
    .colLabel{color:var(--muted2); text-transform:uppercase; letter-spacing:.06em; font-size:11px;}
    .colTitle{font-weight:1000; font-size:18px; letter-spacing:-.02em; margin-top:2px;}
    .chip{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      white-space:nowrap;
    }
    .col.utility .colHead{background: linear-gradient(180deg, rgba(255,59,48,.20), rgba(255,255,255,.05));}
    .col.opt1 .colHead{background: linear-gradient(180deg, rgba(52,199,89,.18), rgba(255,255,255,.05));}
    .col.opt2 .colHead{background: linear-gradient(180deg, rgba(0,194,255,.18), rgba(255,255,255,.05));}

    .totals{
      padding:12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      border-top:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
    }
    .metric{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 12px;
      padding:10px;
    }
    .metric .k{
      color:var(--muted2);
      font-size:11.5px;
      text-transform:uppercase;
      letter-spacing:.06em;
    }
    .metric .v{
      margin-top:6px;
      font-weight:1000;
      font-size:18px;
      letter-spacing:-.02em;
    }

    .tableWrap{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r);
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      background: rgba(0,0,0,.16);
    }
    table{
      width:100%;
      min-width: 680px;
      border-collapse:collapse;
      font-size:13px;
    }
    thead th{
      text-align:left;
      padding:10px 10px;
      color:var(--muted);
      background: rgba(255,255,255,.06);
      border-bottom:1px solid rgba(255,255,255,.10);
      position:sticky; top:0;
    }
    tbody td{
      padding:9px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      color: rgba(255,255,255,.88);
      white-space: nowrap;
    }
    tr.activeYear td{
      background: rgba(0,194,255,.10);
    }

    /* Year Wheel */
    .yearWheelWrap{
      margin-top:14px;
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r2);
      background: rgba(255,255,255,.04);
      overflow:hidden;
    }
    .yearWheelHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: linear-gradient(135deg, rgba(255,122,0,.10), rgba(140,255,63,.06), rgba(0,194,255,.08));
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
      align-items:flex-start;
    }
    .yearWheelHead .title{font-weight:1000; letter-spacing:-.02em;}
    .yearWheelHead .sub{margin-top:6px; color: var(--muted); font-size:13px; line-height:1.35; max-width:820px;}
    .yearWheelBody{
      padding:16px;
      display:grid;
      grid-template-columns: 0.9fr 1.1fr;
      gap:12px;
      align-items:stretch;
    }
    .wheelCard{
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r);
      background: rgba(0,0,0,.20);
      padding:12px;
      display:grid;
      gap:10px;
    }
    .wheelCanvasWrap{
      position:relative;
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: radial-gradient(closest-side, rgba(255,255,255,.06), rgba(0,0,0,.35));
    }
    canvas.wheel{width:100%; height:100%; display:block; touch-action:none;}
    .wheelPointer{
      position:absolute;
      top: 8px;
      left:50%;
      transform: translateX(-50%);
      width:0;height:0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-top: 18px solid rgba(255,255,255,.92);
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.55));
      pointer-events:none;
    }
    .wheelRow{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .yearBadge{
      display:inline-flex; align-items:center; gap:10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      border-radius:999px;
      padding:8px 10px;
      font-weight:1000;
    }
    .yearBadge .pillDot{width:10px;height:10px;border-radius:999px;background: var(--grad);}
    .miniBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      font-weight: 900;
      cursor:pointer;
      min-height: 44px;
      line-height:1;
    }
    .comparePanel{
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r);
      background: rgba(0,0,0,.20);
      padding:12px;
      display:grid;
      gap:12px;
    }
    .compareGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .bigTile{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding:12px;
    }
    .bigTile .k{
      color:var(--muted2);
      font-size:11.5px;
      text-transform:uppercase;
      letter-spacing:.06em;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .bigTile .labelChip{
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      padding:6px 10px;
      font-weight:1000;
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }
    .moneyBig{
      margin-top:8px;
      font-size: clamp(28px, 4.6vw, 46px);
      font-weight: 1000;
      letter-spacing:-.03em;
      line-height:1.0;
    }
    .moneyBig.red{color:var(--red)}
    .moneyBig.green{color:var(--green)}
    .moneyBig.blue{color:var(--blue)}
    .subLine{
      margin-top:6px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
    }
    .savingsLine{
      margin-top:10px;
      border:1px solid rgba(52,199,89,.30);
      background: rgba(52,199,89,.10);
      border-radius: 14px;
      padding:10px 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      font-weight:1000;
    }
    .savingsLine .sLabel{color: rgba(255,255,255,.86);}
    .savingsLine .sVal{color: var(--green); font-size:18px;}

    /* Lightbox */
    .lightbox{
      position:fixed; inset:0;
      background: rgba(0,0,0,.80);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 22px;
      padding-top: calc(22px + env(safe-area-inset-top));
      padding-bottom: calc(22px + env(safe-area-inset-bottom));
      z-index:200;
    }
    .lightbox.open{display:flex;}
    .lightbox-inner{
      max-width:min(1100px, 96vw);
      max-height: 92vh;
      background: rgba(8,12,22,.94);
      border:1px solid rgba(255,255,255,.18);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 30px 120px rgba(0,0,0,.55);
    }
    .lightbox-bar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-weight:900;
      font-size: 13px;
    }
    .lightbox-bar button{
      min-height:44px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding:8px 12px;
      cursor:pointer;
      font-weight:900;
    }
    .lightbox img{width:100%; height:auto; display:block; background:#fff;}

    @media (max-width: 980px){
      .hero{grid-template-columns: 1fr;}
      .span5,.span6,.span7,.span12{grid-column: span 12;}
      .fieldGrid{grid-template-columns: 1fr;}
      .columns{grid-template-columns: 1fr;}
      .yearWheelBody{grid-template-columns: 1fr;}
      .compareGrid{grid-template-columns: 1fr;}
    }

    @media print{
      .topbar{display:none !important;}
      body{background:#fff; color:#000;}
      .section, .hero, .card, figure.bill, .tableWrap, .yearWheelWrap{box-shadow:none !important; background:#fff !important; border-color:#ddd !important;}
      a{color:#000; text-decoration:underline;}
      .btn, .miniBtn{display:none !important;}
      .billCaption{color:#333 !important;}
      .videoError{display:none !important;}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <img id="brandLogo" src="" alt="Leverage Our Sun logo">
        <div class="brandText">
          <div class="brandTitle"><span class="brandGlow"></span> Leverage Our Sun</div>
          <div class="brandSub">TOU problem → net billing → batteries → year-by-year comparison</div>
        </div>
      </div>
      <div class="nav">
        <a class="btn" href="#tou">TOU</a>
        <a class="btn" href="#bills">Bills</a>
        <a class="btn" href="#vpp">VPP</a>
        <a class="btn" href="#outage">Outage</a>
        <a class="btn primary" href="#calculator">Calculator</a>
        <button class="btn" id="btnPrint" type="button">Print / Save PDF</button>
      </div>
    </div>
  </div>

  <main class="container">
    <!-- HERO -->
    <section class="hero">
      <div>
        <h1>Win the day. <span class="gradText">Own the night.</span></h1>
        <p>
          This page uses your real SCE bills to show the problem and the solution, then compares payments year-by-year.
          Use the <b>Year Wheel</b> to jump to Year 2, 3, 4… and instantly see the monthly payments for each option.
        </p>

        <div class="pills">
          <div class="pill"><span class="dot"></span><b>Real Proof:</b> your bills (tap to zoom)</div>
          <div class="pill"><span class="dot"></span><b>Simple Story:</b> TOU → Net Billing → Battery</div>
          <div class="pill"><span class="dot"></span><b>Close Strong:</b> Year Wheel comparison</div>
        </div>

        <div class="heroActions">
          <a class="btn primary" href="#bills">Start with the bills</a>
          <a class="btn" href="#calculator">Jump to Year Wheel</a>
        </div>

        <div class="note">
          iPhone: tap bill images to zoom. Swipe the 25-year table left/right. Drag the Year Wheel to change year.
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 10px;">Appointment quick notes</h3>
        <div class="fieldGrid">
          <label><span>Homeowner name</span><input id="custName" placeholder="John & Jane"></label>
          <label><span>City</span><input id="custCity" placeholder="Murrieta, CA"></label>
          <label><span>Major loads</span><input id="custLoads" placeholder="EV / pool / A/C"></label>
          <label><span>Goal</span><input id="custGoal" placeholder="Lower bill + backup power"></label>
        </div>
        <div style="margin-top:12px;color:var(--muted2);font-size:12.5px;line-height:1.45;">
          Use Print/PDF for a clean recap after the appointment.
        </div>
      </div>
    </section>

    <!-- TOU -->
    <section class="section" id="tou">
      <div class="sectionHead">
        <div>
          <h2><span class="spark"></span> 1) Time-of-Use: the “when” problem</h2>
          <p>
            Edison prices change by time of day. The expensive window is when most families are home.
            Use these official links for current TOU information and rate changes.
          </p>
        </div>
        <div class="badgeRow">
          <span class="badge problem">Problem: Peak pricing</span>
          <span class="badge energy">Credibility: official links</span>
        </div>
      </div>

      <div class="sectionBody grid12">
        <div class="span5">
          <div class="callout">
            <h3>Talk track</h3>
            <ul>
              <li><b>Not just how much</b> you use — <b>when</b> you use it</li>
              <li><b>Evening peak</b> is the expensive window</li>
              <li><b>Batteries</b> shift usage away from peak</li>
            </ul>
          </div>

          <div class="card" style="margin-top:12px;">
            <div style="color:var(--muted2);font-size:11.5px;letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;">
              Official Edison links
            </div>
            <div style="display:grid;gap:10px;">
              <a class="btn" style="text-align:left;" target="_blank" rel="noreferrer"
                 href="https://www.sce.com/save-money/rates-financing/residential-rate-plans/time-of-use-plans">
                SCE Residential TOU Plans (current)
              </a>
              <a class="btn" style="text-align:left;" target="_blank" rel="noreferrer"
                 href="https://www.sce.com/save-money/rates-financing/sce-rate-advisory">
                SCE Rates Advisory (rate changes)
              </a>
            </div>
          </div>

          <div class="note">
            “Solar produces during the day. Batteries cover the expensive hours at night.”
          </div>
        </div>

        <div class="span7">
          <figure class="bill">
            <img id="imgUtilityOnly" src="" alt="SCE utility-only bill (non-solar)"
                 data-zoom-title="Utility-Only SCE Bill (No Solar)" />
            <div class="billCaption">
              <span class="tag"><span class="mini"></span> Tap to zoom</span>
              <span class="tag"><span class="mini"></span> Proof of the problem</span>
            </div>
          </figure>
        </div>
      </div>
    </section>

    <!-- Bills -->
    <section class="section" id="bills">
      <div class="sectionHead">
        <div>
          <h2><span class="spark"></span> 2) Bills proof: Utility vs Solar Net Billing</h2>
          <p>
            Solar helps, but Net Billing can still leave you exposed in the evening. Storage changes the outcome.
          </p>
        </div>
        <div class="badgeRow">
          <span class="badge problem">Utility (red)</span>
          <span class="badge energy">Net Billing</span>
          <span class="badge solution">Storage impact</span>
        </div>
      </div>

      <div class="sectionBody grid12">
        <div class="span6">
          <div class="callout" style="border-color:rgba(255,59,48,.26);background:rgba(255,59,48,.10);">
            <h3>Utility-only (problem)</h3>
            <ul>
              <li>High exposure to TOU peaks</li>
              <li>Rate increases compound</li>
              <li>No backup power</li>
            </ul>
          </div>
        </div>

        <div class="span6">
          <div class="callout" style="border-color:rgba(0,194,255,.26);background:rgba(0,194,255,.10);">
            <h3>Solar Net Billing (reality)</h3>
            <ul>
              <li>Solar offsets daytime usage</li>
              <li>Evening power is still expensive</li>
              <li>Storage is what “wins the night”</li>
            </ul>
          </div>
        </div>

        <div class="span12">
          <figure class="bill">
            <img id="imgSolarNetBilling" src="" alt="SCE solar net billing bill"
                 data-zoom-title="Solar Only – Net Billing (Still TOU Exposed)" />
            <div class="billCaption">
              <span class="tag"><span class="mini"></span> Tap to zoom</span>
              <span class="tag"><span class="mini"></span> Net Billing proof</span>
            </div>
          </figure>
        </div>
      </div>
    </section>

    <!-- VPP Links only -->
    <section class="section" id="vpp">
      <div class="sectionHead">
        <div>
          <h2><span class="spark"></span> 3) Tesla Virtual Power Plant (VPP)</h2>
          <p>
            Use these official Tesla links to explain what VPP is, eligibility, and how incentives work.
          </p>
        </div>
        <div class="badgeRow">
          <span class="badge energy">Tesla</span>
          <span class="badge solution">Extra value</span>
        </div>
      </div>

      <div class="sectionBody grid12">
        <div class="card span6">
          <div style="color:var(--muted2);font-size:11.5px;letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;">
            Official Tesla VPP (SCE)
          </div>
          <a class="btn" style="width:100%; text-align:left;" target="_blank" rel="noreferrer"
             href="https://www.tesla.com/support/energy/virtual-power-plant/sce">
            Tesla VPP with SCE (official)
          </a>
          <div class="note" style="margin-top:12px;">
            “When eligible, the battery can support the grid during events — and incentives may apply.”
          </div>
        </div>

        <div class="card span6">
          <div style="color:var(--muted2);font-size:11.5px;letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;">
            Incentives overview
          </div>
          <a class="btn" style="width:100%; text-align:left;" target="_blank" rel="noreferrer"
             href="https://www.tesla.com/support/energy/powerwall/learn/incentives">
            Tesla Powerwall incentives overview (official)
          </a>
          <div class="note" style="margin-top:12px;">
            “Savings + backup power are the core value. VPP can be bonus value.”
          </div>
        </div>
      </div>
    </section>

    <!-- Outage Video -->
    <section class="section" id="outage">
      <div class="sectionHead">
        <div>
          <h2><span class="spark"></span> 4) Outage demo video</h2>
          <p>
            The battery powers the home when the grid goes down. This video is configured to play inline on iPhones.
          </p>
        </div>
        <div class="badgeRow">
          <span class="badge energy">Backup</span>
          <span class="badge solution">Confidence</span>
        </div>
      </div>

      <div class="sectionBody">
        <div class="videoWrap">
          <video id="outageVideo" controls playsinline preload="metadata" muted>
            <!-- MP4 first if provided -->
            <source id="outageMp4" src="" type="video/mp4">
            <!-- MOV fallback -->
            <source id="outageMov" src="" type="video/quicktime">
            Your browser can’t play this video.
          </video>
        </div>

        <div class="videoError" id="videoError">
          <b>Video didn’t load.</b><br/>
          GitHub RAW sometimes fails to serve <b>.mov</b> in a way that browsers accept. Best fix:
          export the same clip as <b>.mp4 (H.264)</b>, upload it to the repo, then paste that mp4 RAW link into <b>OUTAGE_VIDEO_URL_MP4</b> in SETTINGS.
        </div>

        <div class="note">
          If your MOV loads on desktop but not iPhone, an MP4 copy is the reliable solution.
        </div>
      </div>
    </section>

    <!-- Calculator -->
    <section class="section" id="calculator">
      <div class="sectionHead">
        <div>
          <h2><span class="spark"></span> 5) 25-Year comparison calculator</h2>
          <p>
            Enter monthly payment + escalator for each option. Then use the <b>Year Wheel</b> to compare Year 2, 3, 4…
          </p>
        </div>
        <div class="badgeRow">
          <span class="badge problem">Utility (red)</span>
          <span class="badge.solution badge">Option 1 (green)</span>
          <span class="badge energy">Option 2 (blue)</span>
        </div>
      </div>

      <div class="sectionBody">
        <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px;">
          <div style="color:var(--muted);font-size:13px;">Live updates as you type.</div>
          <button class="btn" id="btnReset" type="button">Reset example</button>
        </div>

        <div class="columns">
          <!-- Utility -->
          <div class="col utility">
            <div class="colHead">
              <div>
                <div class="colLabel">Current Utility</div>
                <div class="colTitle">Edison</div>
              </div>
              <div class="chip">Red</div>
            </div>
            <div style="padding:12px;display:grid;gap:10px;">
              <label><span>Avg monthly bill ($)</span><input id="uPay" value="458" inputmode="decimal"></label>
              <label><span>Annual increase (%)</span><input id="uEsc" value="9" inputmode="decimal"></label>
            </div>
            <div class="totals">
              <div class="metric"><div class="k">25-Year total</div><div class="v" style="color:var(--red)" id="uTotal">$0</div></div>
              <div class="metric"><div class="k">Year 25 monthly</div><div class="v" id="uY25">$0</div></div>
            </div>
          </div>

          <!-- Option 1 -->
          <div class="col opt1">
            <div class="colHead">
              <div>
                <div class="colLabel">Option 1</div>
                <div class="colTitle">Solar + Battery</div>
              </div>
              <div class="chip">Green</div>
            </div>
            <div style="padding:12px;display:grid;gap:10px;">
              <label><span>Avg monthly payment ($)</span><input id="o1Pay" value="295" inputmode="decimal"></label>
              <label><span>Annual escalator (%)</span><input id="o1Esc" value="3.5" inputmode="decimal"></label>
            </div>
            <div class="totals">
              <div class="metric"><div class="k">25-Year total</div><div class="v" id="o1Total">$0</div></div>
              <div class="metric"><div class="k">Savings vs utility</div><div class="v" style="color:var(--green)" id="o1Save">$0</div></div>
            </div>
          </div>

          <!-- Option 2 -->
          <div class="col opt2">
            <div class="colHead">
              <div>
                <div class="colLabel">Option 2</div>
                <div class="colTitle">Solar + Battery</div>
              </div>
              <div class="chip">Blue</div>
            </div>
            <div style="padding:12px;display:grid;gap:10px;">
              <label><span>Avg monthly payment ($)</span><input id="o2Pay" value="310" inputmode="decimal"></label>
              <label><span>Annual escalator (%)</span><input id="o2Esc" value="0" inputmode="decimal"></label>
            </div>
            <div class="totals">
              <div class="metric"><div class="k">25-Year total</div><div class="v" id="o2Total">$0</div></div>
              <div class="metric"><div class="k">Savings vs utility</div><div class="v" style="color:var(--green)" id="o2Save">$0</div></div>
            </div>
          </div>
        </div>

        <div class="tableWrap" aria-label="25-year table (swipe left/right on phones)">
          <table>
            <thead>
              <tr>
                <th style="width:70px">Year</th>
                <th>Utility Monthly</th>
                <th>Option 1 Monthly</th>
                <th>Option 2 Monthly</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>

        <!-- YEAR WHEEL (the one you asked for) -->
        <div class="yearWheelWrap" id="yearwheel">
          <div class="yearWheelHead">
            <div>
              <div class="title">Year Wheel Comparison</div>
              <div class="sub">
                Drag and spin to pick <b>Year 1–25</b>. The panel shows that year’s <b>monthly payment</b> for Utility (red),
                Option 1 (green), Option 2 (blue) — plus savings vs utility.
              </div>
            </div>
            <div class="wheelRow">
              <div class="yearBadge"><span class="pillDot"></span> Selected: <span id="selectedYearText">Year 1</span></div>
              <button class="miniBtn" id="spinYear">Spin</button>
              <button class="miniBtn" id="jumpYear1">Year 1</button>
              <button class="miniBtn" id="jumpYear5">Year 5</button>
              <button class="miniBtn" id="jumpYear10">Year 10</button>
              <button class="miniBtn" id="jumpYear25">Year 25</button>
            </div>
          </div>

          <div class="yearWheelBody">
            <div class="wheelCard">
              <div class="wheelCanvasWrap">
                <div class="wheelPointer"></div>
                <canvas class="wheel" id="yearWheel"></canvas>
              </div>
              <div class="note" style="margin-top:0;">
                Tip: This is a killer close — “Let’s look at Year 5… now Year 10… now Year 25.”
              </div>
            </div>

            <div class="comparePanel">
              <div class="compareGrid">
                <div class="bigTile">
                  <div class="k">Utility <span class="labelChip" style="border-color:rgba(255,59,48,.35);">Red</span></div>
                  <div class="moneyBig red" id="uYearMonthly">$0</div>
                  <div class="subLine" id="uYearAnnual">Annual: $0</div>
                </div>

                <div class="bigTile">
                  <div class="k">Option 1 <span class="labelChip" style="border-color:rgba(52,199,89,.35);">Green</span></div>
                  <div class="moneyBig green" id="o1YearMonthly">$0</div>
                  <div class="subLine" id="o1YearAnnual">Annual: $0</div>
                </div>

                <div class="bigTile">
                  <div class="k">Option 2 <span class="labelChip" style="border-color:rgba(0,194,255,.35);">Blue</span></div>
                  <div class="moneyBig blue" id="o2YearMonthly">$0</div>
                  <div class="subLine" id="o2YearAnnual">Annual: $0</div>
                </div>
              </div>

              <div class="savingsLine">
                <div class="sLabel">Savings vs Utility (Selected Year)</div>
                <div class="sVal" id="yearSavings">$0</div>
              </div>

              <div class="note" style="margin-top:0;">
                If savings is negative, it turns red (good for honest comparisons).
              </div>
            </div>
          </div>
        </div>

        <div class="note" style="margin-top:14px;">
          Closing line: “If it saves you money now and keeps your home powered later, the question becomes — why keep renting power from the utility?”
        </div>
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image viewer">
    <div class="lightbox-inner">
      <div class="lightbox-bar">
        <div id="lightboxTitle">Preview</div>
        <button id="lightboxClose" type="button">Close</button>
      </div>
      <img id="lightboxImg" alt="Zoomed image"/>
    </div>
  </div>

  <script>
    // =============================
    // SETTINGS (your assets)
    // =============================
    const LOGO_URL =
      "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/4A5B0E0C-50D9-4752-8469-F61A667110D8.png";

    const UTILITY_ONLY_BILL_URL =
      "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_8578.jpeg";

    const SOLAR_NET_BILLING_BILL_URL =
      "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_9100.jpeg";

    // You provided: RecordIt-1770162136.mov
    // We try MOV. For maximum compatibility, set OUTAGE_VIDEO_URL_MP4 to an MP4 RAW link if you upload one.
    const OUTAGE_VIDEO_URL_MOV =
      "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/RecordIt-1770162136.mov";
    const OUTAGE_VIDEO_URL_MP4 = ""; // e.g. "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/RecordIt-1770162136.mp4"

    // =============================
    // Helpers
    // =============================
    const $ = (id) => document.getElementById(id);

    function toNumber(val){
      const n = parseFloat(String(val).replace(/[^0-9.\-]/g,''));
      return Number.isFinite(n) ? n : 0;
    }
    function money0(n){
      const x = Number.isFinite(n) ? n : 0;
      return x.toLocaleString(undefined, { style:'currency', currency:'USD', maximumFractionDigits: 0 });
    }
    function money2(n){
      const x = Number.isFinite(n) ? n : 0;
      return x.toLocaleString(undefined, { style:'currency', currency:'USD', maximumFractionDigits: 2 });
    }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    // =============================
    // Wire assets
    // =============================
    $('brandLogo').src = LOGO_URL;
    $('imgUtilityOnly').src = UTILITY_ONLY_BILL_URL;
    $('imgSolarNetBilling').src = SOLAR_NET_BILLING_BILL_URL;

    // Video sources
    $('outageMp4').src = OUTAGE_VIDEO_URL_MP4 || "";
    $('outageMov').src = OUTAGE_VIDEO_URL_MOV || "";

    const video = $('outageVideo');
    const videoError = $('videoError');

    // Some servers return a content-type that browsers reject; show a friendly error.
    video.addEventListener('error', () => {
      videoError.style.display = "block";
    });
    // Also show if source fails to load
    video.querySelectorAll('source').forEach(s => {
      s.addEventListener?.('error', () => { videoError.style.display = "block"; });
    });
    video.load();

    // =============================
    // Calculator
    // =============================
    function monthlyByYear(baseMonthly, annualEscPct, years=25){
      const esc = annualEscPct / 100;
      const arr = [];
      for(let y=1; y<=years; y++){
        arr.push(baseMonthly * Math.pow(1+esc, y-1));
      }
      return arr;
    }
    function total25yr(baseMonthly, annualEscPct){
      const series = monthlyByYear(baseMonthly, annualEscPct, 25);
      return series.reduce((sum, m) => sum + (m*12), 0);
    }

    // cached series for Year Wheel panel
    let cache = {
      uSeries: Array(25).fill(0),
      o1Series: Array(25).fill(0),
      o2Series: Array(25).fill(0)
    };

    function render(){
      const uPay = toNumber($('uPay').value);
      const uEsc = toNumber($('uEsc').value);

      const o1Pay = toNumber($('o1Pay').value);
      const o1Esc = toNumber($('o1Esc').value);

      const o2Pay = toNumber($('o2Pay').value);
      const o2Esc = toNumber($('o2Esc').value);

      cache.uSeries = monthlyByYear(uPay, uEsc, 25);
      cache.o1Series = monthlyByYear(o1Pay, o1Esc, 25);
      cache.o2Series = monthlyByYear(o2Pay, o2Esc, 25);

      const uTotal = total25yr(uPay, uEsc);
      const o1Total = total25yr(o1Pay, o1Esc);
      const o2Total = total25yr(o2Pay, o2Esc);

      $('uTotal').textContent = money0(uTotal);
      $('o1Total').textContent = money0(o1Total);
      $('o2Total').textContent = money0(o2Total);

      const s1 = uTotal - o1Total;
      const s2 = uTotal - o2Total;

      $('o1Save').textContent = money0(s1);
      $('o2Save').textContent = money0(s2);

      $('o1Save').style.color = s1 >= 0 ? 'var(--green)' : 'var(--red)';
      $('o2Save').style.color = s2 >= 0 ? 'var(--green)' : 'var(--red)';

      $('uY25').textContent = money2(cache.uSeries[24]);

      // table
      const tbody = $('rows');
      tbody.innerHTML = '';
      for(let y=1; y<=25; y++){
        const tr = document.createElement('tr');
        tr.dataset.year = String(y);
        tr.innerHTML = `
          <td>${y}</td>
          <td>${money2(cache.uSeries[y-1])}</td>
          <td>${money2(cache.o1Series[y-1])}</td>
          <td>${money2(cache.o2Series[y-1])}</td>
        `;
        tbody.appendChild(tr);
      }

      // keep year panel consistent
      updateYearPanel(selectedYear);
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', render));

    $('btnPrint').addEventListener('click', () => window.print());
    $('btnReset').addEventListener('click', () => {
      $('uPay').value = '458';
      $('uEsc').value = '9';
      $('o1Pay').value = '295';
      $('o1Esc').value = '3.5';
      $('o2Pay').value = '310';
      $('o2Esc').value = '0';
      selectedYear = 1;
      yearWheel.setYear(1, true);
      render();
    });

    // =============================
    // Lightbox zoom
    // =============================
    const lb = $('lightbox');
    const lbImg = $('lightboxImg');
    const lbTitle = $('lightboxTitle');
    function openLightbox(src, title){
      lbImg.src = src;
      lbTitle.textContent = title || 'Preview';
      lb.classList.add('open');
    }
    function closeLightbox(){
      lb.classList.remove('open');
      lbImg.src = '';
    }
    document.querySelectorAll('img[data-zoom-title]').forEach(img => {
      img.addEventListener('click', () => {
        if(!img.src) return;
        openLightbox(img.src, img.dataset.zoomTitle);
      });
    });
    $('lightboxClose').addEventListener('click', closeLightbox);
    lb.addEventListener('click', (e) => { if(e.target === lb) closeLightbox(); });
    document.addEventListener('keydown', (e) => { if(e.key === 'Escape') closeLightbox(); });

    window.addEventListener('hashchange', () => setTimeout(() => window.scrollBy(0, -6), 0));

    // =============================
    // Year Wheel (Price-is-Right vibe)
    // =============================
    const YEARS = Array.from({length:25}, (_,i)=>i+1);
    let selectedYear = 1;

    function getStyleVar(name){
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }
    function rgbaFromHex(hex, alpha){
      if(hex.startsWith("#") && hex.length === 7){
        const r = parseInt(hex.slice(1,3),16);
        const g = parseInt(hex.slice(3,5),16);
        const b = parseInt(hex.slice(5,7),16);
        return `rgba(${r},${g},${b},${alpha})`;
      }
      return `rgba(255,255,255,${alpha})`;
    }

    class YearWheel {
      constructor(canvasId){
        this.canvas = $(canvasId);
        this.ctx = this.canvas.getContext('2d');
        this.theta = 0;
        this.omega = 0;
        this.dragging = false;
        this.lastPointer = null;
        this.lastT = 0;

        this.resize();
        window.addEventListener('resize', () => this.resize());
        this.bind();
        this.draw();
        requestAnimationFrame((t)=>this.tick(t));
      }

      resize(){
        const rect = this.canvas.getBoundingClientRect();
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        this.canvas.width = Math.round(rect.width * dpr);
        this.canvas.height = Math.round(rect.height * dpr);
        this.ctx.setTransform(dpr,0,0,dpr,0,0);
        this.draw();
      }

      bind(){
        const onDown = (e) => {
          this.dragging = true;
          this.omega = 0;
          this.lastPointer = this.getPointer(e);
          this.lastT = performance.now();
          this.canvas.setPointerCapture?.(e.pointerId);
        };
        const onMove = (e) => {
          if(!this.dragging) return;
          const p = this.getPointer(e);
          const c = this.center();
          const a1 = Math.atan2(this.lastPointer.y - c.y, this.lastPointer.x - c.x);
          const a2 = Math.atan2(p.y - c.y, p.x - c.x);
          let da = a2 - a1;
          if(da > Math.PI) da -= Math.PI*2;
          if(da < -Math.PI) da += Math.PI*2;

          this.theta += da;
          const now = performance.now();
          const dt = Math.max(0.016, (now - this.lastT)/1000);
          this.omega = da / dt;
          this.lastT = now;
          this.lastPointer = p;
          this.snapEmit();
        };
        const onUp = () => {
          if(!this.dragging) return;
          this.dragging = false;
          this.omega = clamp(this.omega, -14, 14);
        };

        this.canvas.addEventListener('pointerdown', onDown);
        window.addEventListener('pointermove', onMove, { passive:false });
        window.addEventListener('pointerup', onUp);

        this.canvas.addEventListener('dblclick', () => this.spin());
      }

      getPointer(e){
        const rect = this.canvas.getBoundingClientRect();
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }
      center(){
        const rect = this.canvas.getBoundingClientRect();
        return { x: rect.width/2, y: rect.height/2 };
      }

      seg(){
        return (Math.PI*2) / YEARS.length;
      }
      angleToYear(){
        let a = this.theta % (Math.PI*2);
        if(a < 0) a += Math.PI*2;
        const seg = this.seg();
        const shifted = (a + Math.PI/2) % (Math.PI*2);
        const idx = clamp(Math.floor(shifted / seg), 0, YEARS.length-1);
        return YEARS[idx];
      }
      yearToAngle(year){
        const idx = clamp(year-1, 0, YEARS.length-1);
        const seg = this.seg();
        const shifted = idx*seg + seg/2;
        return shifted - Math.PI/2;
      }

      setYear(year, immediate=false){
        const target = this.yearToAngle(year);
        const twoPi = Math.PI*2;
        let a = target;
        while(a - this.theta > Math.PI) a -= twoPi;
        while(this.theta - a > Math.PI) a += twoPi;

        if(immediate){
          this.theta = a;
          this.omega = 0;
          this.snapEmit();
          return;
        }
        const start = this.theta;
        const delta = a - start;
        const startTime = performance.now();
        const dur = 260;

        const anim = (t) => {
          const p = clamp((t - startTime)/dur, 0, 1);
          const ease = 1 - Math.pow(1-p, 3);
          this.theta = start + delta*ease;
          this.snapEmit();
          if(p < 1) requestAnimationFrame(anim);
          else this.omega = 0;
        };
        requestAnimationFrame(anim);
      }

      spin(){
        const dir = Math.random() < 0.5 ? -1 : 1;
        this.omega = dir * (9 + Math.random()*9);
      }

      snapEmit(){
        // draw + emit selected year
        this.draw();
        const y = this.angleToYear();
        if(this.onYear) this.onYear(y);
      }

      tick(t){
        const dt = this.lastTick ? (t - this.lastTick)/1000 : 0;
        this.lastTick = t;

        if(!this.dragging){
          const friction = 3.4;
          if(Math.abs(this.omega) > 0.02){
            const sign = Math.sign(this.omega);
            this.omega -= sign * friction * dt;
            if(Math.sign(this.omega) !== sign) this.omega = 0;
            this.theta += this.omega * dt;
            this.snapEmit();
          } else {
            // gentle snap to nearest year
            const y = this.angleToYear();
            const target = this.yearToAngle(y);
            let diff = target - this.theta;
            if(diff > Math.PI) diff -= Math.PI*2;
            if(diff < -Math.PI) diff += Math.PI*2;
            this.theta += diff * Math.min(1, 10*dt);
            this.snapEmit();
          }
        }
        requestAnimationFrame((tt)=>this.tick(tt));
      }

      draw(){
        const ctx = this.ctx;
        const rect = this.canvas.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        const cx = w/2, cy = h/2;
        const r = Math.min(w,h)*0.46;

        ctx.clearRect(0,0,w,h);
        ctx.save();
        ctx.translate(cx,cy);

        const seg = this.seg();
        const red = rgbaFromHex(getStyleVar("--red"), 0.20);
        const green = rgbaFromHex(getStyleVar("--green"), 0.20);
        const blue = rgbaFromHex(getStyleVar("--cyan"), 0.20);

        // outer ring
        ctx.beginPath();
        ctx.arc(0,0,r*1.08,0,Math.PI*2);
        ctx.fillStyle = "rgba(255,255,255,0.02)";
        ctx.fill();

        for(let i=0;i<YEARS.length;i++){
          const a0 = this.theta + i*seg;
          const a1 = a0 + seg;

          ctx.beginPath();
          ctx.moveTo(0,0);
          ctx.arc(0,0,r,a0,a1);
          ctx.closePath();

          // alternating base shade
          ctx.fillStyle = (i%2===0) ? "rgba(255,255,255,0.06)" : "rgba(255,255,255,0.03)";
          ctx.fill();

          // color accents in a repeating pattern (gives game-show energy)
          if(i % 3 === 0){ ctx.globalAlpha = 1; ctx.fillStyle = red; ctx.fill(); }
          if(i % 3 === 1){ ctx.globalAlpha = 1; ctx.fillStyle = green; ctx.fill(); }
          if(i % 3 === 2){ ctx.globalAlpha = 1; ctx.fillStyle = blue; ctx.fill(); }

          ctx.strokeStyle = "rgba(255,255,255,0.08)";
          ctx.lineWidth = 1;
          ctx.stroke();

          // labels
          const mid = (a0+a1)/2;
          const tx = Math.cos(mid) * (r*0.78);
          const ty = Math.sin(mid) * (r*0.78);
          ctx.save();
          ctx.translate(tx,ty);
          ctx.rotate(mid + Math.PI/2);
          ctx.fillStyle = "rgba(255,255,255,0.88)";
          ctx.font = `1000 ${Math.max(10, r*0.085)}px ui-sans-serif, system-ui, -apple-system`;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(String(YEARS[i]), 0, 0);
          ctx.restore();
        }

        // inner circle
        ctx.beginPath();
        ctx.arc(0,0,r*0.58,0,Math.PI*2);
        ctx.fillStyle = "rgba(0,0,0,0.34)";
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.12)";
        ctx.lineWidth = 2;
        ctx.stroke();

        // center text
        const y = this.angleToYear();
        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.font = `900 ${Math.max(16, r*0.15)}px ui-sans-serif, system-ui, -apple-system`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("YEAR", 0, -r*0.06);

        ctx.fillStyle = "rgba(255,255,255,0.84)";
        ctx.font = `1000 ${Math.max(22, r*0.22)}px ui-sans-serif, system-ui, -apple-system`;
        ctx.fillText(String(y), 0, r*0.16);

        // center bolt
        ctx.beginPath();
        ctx.arc(0,0,r*0.06,0,Math.PI*2);
        ctx.fillStyle = "rgba(255,233,74,0.85)";
        ctx.fill();

        ctx.restore();
      }
    }

    function updateYearPanel(year){
      selectedYear = clamp(year, 1, 25);
      $('selectedYearText').textContent = `Year ${selectedYear}`;

      // highlight table row
      document.querySelectorAll('#rows tr').forEach(tr => tr.classList.remove('activeYear'));
      const tr = document.querySelector(`#rows tr[data-year="${selectedYear}"]`);
      if(tr) tr.classList.add('activeYear');

      const idx = selectedYear - 1;
      const uM = cache.uSeries[idx] ?? 0;
      const o1M = cache.o1Series[idx] ?? 0;
      const o2M = cache.o2Series[idx] ?? 0;

      $('uYearMonthly').textContent = money2(uM);
      $('o1YearMonthly').textContent = money2(o1M);
      $('o2YearMonthly').textContent = money2(o2M);

      $('uYearAnnual').textContent = `Annual: ${money0(uM*12)}`;
      $('o1YearAnnual').textContent = `Annual: ${money0(o1M*12)}`;
      $('o2YearAnnual').textContent = `Annual: ${money0(o2M*12)}`;

      // savings vs utility for this year: choose best of options (lower monthly)
      const best = Math.min(o1M, o2M);
      const savings = (uM - best) * 12;
      $('yearSavings').textContent = money0(savings);
      $('yearSavings').style.color = savings >= 0 ? 'var(--green)' : 'var(--red)';
    }

    const yearWheel = new YearWheel("yearWheel");
    yearWheel.onYear = (y) => updateYearPanel(y);

    $('spinYear').addEventListener('click', () => yearWheel.spin());
    $('jumpYear1').addEventListener('click', () => yearWheel.setYear(1));
    $('jumpYear5').addEventListener('click', () => yearWheel.setYear(5));
    $('jumpYear10').addEventListener('click', () => yearWheel.setYear(10));
    $('jumpYear25').addEventListener('click', () => yearWheel.setYear(25));

    // Initial render
    yearWheel.setYear(1, true);
    render();
  </script>
</body>
</html>
