<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Solar + Storage Closing Tool</title>
<meta name="theme-color" content="#0b1017"/>

<style>
  :root{
    --navy:#0b1017;
    --navy2:#06122a;
    --gold:#FBC909;
    --teal:#3AADBB;

    --utility:#ff3b30;
    --opt1:#34c759;
    --opt2:#00c2ff;

    --text:rgba(255,255,255,.96);
    --muted:rgba(255,255,255,.72);
    --muted2:rgba(255,255,255,.56);
    --grad:linear-gradient(135deg,var(--gold),var(--teal));
    --shadow: 0 18px 70px rgba(0,0,0,.45);

    --r2:22px;

    --safeT: env(safe-area-inset-top);
    --safeB: env(safe-area-inset-bottom);
    --safeL: env(safe-area-inset-left);
    --safeR: env(safe-area-inset-right);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(900px 460px at 14% 10%, rgba(251,201,9,.18), transparent 60%),
      radial-gradient(900px 460px at 86% 12%, rgba(58,173,187,.16), transparent 60%),
      linear-gradient(180deg, var(--navy2), var(--navy));
    overflow:hidden;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  a{color:#cfe8ff;text-decoration:none}
  a:hover{text-decoration:underline}
  button, a, input { -webkit-tap-highlight-color: transparent; }

  /* ===== Top Bar ===== */
  .topbar{
    position:fixed; inset:0 0 auto 0;
    z-index:100;
    padding-top:var(--safeT);
    background: rgba(10,16,24,.90);
    border-bottom:1px solid rgba(255,255,255,.12);
  }
  .topbarInner{
    max-width:1280px;
    margin:0 auto;
    padding:12px 16px;
    padding-left: calc(16px + var(--safeL));
    padding-right: calc(16px + var(--safeR));
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .brand{display:flex; align-items:center; gap:12px; min-width:240px;}
  .brand img{
    height:40px; width:auto; display:block;
    filter:drop-shadow(0 12px 28px rgba(0,0,0,.30));
  }
  .brandTitle{display:flex; flex-direction:column; line-height:1.1}
  .brandTitle .name{
    font-weight:1000; letter-spacing:-.02em;
    display:flex; align-items:center; gap:10px;
  }
  .dot{
    width:10px;height:10px;border-radius:999px;
    background:var(--grad);
    box-shadow: 0 0 0 6px rgba(251,201,9,.10), 0 0 26px rgba(58,173,187,.18);
  }
  .brandTitle .sub{
    font-size:12px; color:var(--muted2);
    margin-top:3px; letter-spacing:.02em;
  }

  .nav{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;}
  .btn{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:var(--text);
    padding:11px 14px;
    border-radius:14px;
    font-weight:950;
    cursor:pointer;
    min-height:44px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    user-select:none;
  }
  .btn.primary{
    background: var(--grad);
    color:#07121b;
    border-color: rgba(255,255,255,.18);
    box-shadow: 0 18px 58px rgba(58,173,187,.14), 0 18px 58px rgba(251,201,9,.10);
  }
  .btn.danger{border-color: rgba(255,59,48,.25); background: rgba(255,59,48,.10);}

  /* ===== Mobile compact topbar: hide big nav, keep only hamburger ===== */
  .hamburger{display:none}
  .mobileControls{display:none}
  @media (max-width: 720px){
    .topbarInner{
      padding:10px 12px;
      gap:10px;
    }
    .brand img{height:34px}
    .brandTitle .sub{display:none}
    .nav{display:none} /* hide big row */
    .hamburger{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-height:44px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
    }
    .mobileControls{
      display:flex;
      gap:10px;
      align-items:center;
    }
  }

  .progressWrap{
    max-width:1280px; margin:0 auto;
    padding: 0 16px 10px;
    padding-left: calc(16px + var(--safeL));
    padding-right: calc(16px + var(--safeR));
  }
  .progress{
    height:7px;
    border-radius:999px;
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
  }
  .progress > div{height:100%; width:0%; background:var(--grad); transition: width .16s ease;}

  .badge{
    position:fixed;
    top: calc(12px + var(--safeT));
    right: 12px;
    z-index:120;
    display:flex;
    align-items:center;
    gap:10px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.24);
    border-radius:999px;
    padding:10px 12px;
  }
  .badge .t{font-weight:1000; color: rgba(255,255,255,.90); font-size:13px; letter-spacing:-.02em;}

  /* ===== Fullscreen button ===== */
  .fsBtn{
    position:fixed;
    top: calc(12px + var(--safeT));
    left: 12px;
    z-index:130;
  }
  @media (max-width:720px){
    .fsBtn{display:none;} /* keep UI clean on phones; fullscreen still accessible in menu */
    .badge{display:none;} /* reduce clutter on phones */
  }

  /* ===== Deck ===== */
  .deck{
    height:100%;
    padding-top: calc(96px + var(--safeT));
    padding-bottom: calc(92px + var(--safeB));
    display:flex;
    align-items:stretch;
    justify-content:center;
  }
  @media (max-width:720px){
    .deck{
      padding-top: calc(70px + var(--safeT));
      padding-bottom: calc(82px + var(--safeB));
    }
  }
  .stage{
    width:min(1280px, 100vw);
    height:100%;
    padding: 14px 16px;
    padding-left: calc(16px + var(--safeL));
    padding-right: calc(16px + var(--safeR));
    position:relative;
  }
  @media (max-width:720px){
    .stage{ padding: 10px 12px; }
  }
  .slide{
    position:absolute;
    inset:14px 16px;
    inset-left: calc(16px + var(--safeL));
    inset-right: calc(16px + var(--safeR));
    border:1px solid rgba(255,255,255,.14);
    border-radius: var(--r2);
    background: rgba(255,255,255,.05);
    overflow:hidden;
    opacity:0;
    transform: translateY(10px) scale(.99);
    pointer-events:none;
    transition: opacity .16s ease, transform .16s ease;
    box-shadow: var(--shadow);
  }
  @media (max-width:720px){
    .slide{
      inset:10px 12px;
      inset-left: calc(12px + var(--safeL));
      inset-right: calc(12px + var(--safeR));
    }
  }
  .slide.active{opacity:1; transform: translateY(0) scale(1); pointer-events:auto;}
  .slideHead{
    padding:16px 18px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }
  @media (max-width:720px){
    .slideHead{ padding:12px 12px; }
  }
  .slideHead h2{
    margin:0;
    font-size: 15px;
    letter-spacing:.04em;
    text-transform:uppercase;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .spark{width:10px;height:10px;border-radius:999px;background:var(--grad); box-shadow:0 0 22px rgba(251,201,9,.14), 0 0 22px rgba(58,173,187,.12);}
  .slideBody{
    padding:18px;
    height: calc(100% - 58px);
    overflow:auto;
    -webkit-overflow-scrolling: touch;
  }
  @media (max-width:720px){
    .slideBody{ padding:12px; }
  }

  /* ===== Bottom dock (phones: just Prev/Next, big, easy) ===== */
  .presentBar{
    position:fixed;
    left: max(10px, var(--safeL));
    right: max(10px, var(--safeR));
    bottom: calc(10px + var(--safeB));
    z-index:140;
    display:flex;
    justify-content:center;
    pointer-events:none;
  }
  .dock{
    pointer-events:auto;
    width:min(960px, 100%);
    display:grid;
    grid-template-columns: 1fr 1.4fr 1fr;
    gap:12px;
    padding:12px;
    border-radius:20px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(10,16,24,.88);
    box-shadow: 0 20px 70px rgba(0,0,0,.45);
  }
  .dock .btn{
    width:100%;
    min-height:52px;
    font-size:15px;
    font-weight:1000;
  }

  @media (max-width:720px){
    .dock{
      grid-template-columns: 1fr 1fr; /* prev/next only */
      gap:10px;
      padding:10px;
    }
    .dock .btn{
      min-height:54px;
      font-size:16px;
    }
    #btnStartDock{display:none;}
  }

  /* ===== Slide menu drawer (mobile) ===== */
  .drawerOverlay{
    position:fixed; inset:0;
    background: rgba(0,0,0,.55);
    z-index:200;
    opacity:0;
    pointer-events:none;
    transition: opacity .16s ease;
  }
  .drawerOverlay.open{opacity:1; pointer-events:auto;}
  .drawer{
    position:fixed;
    left: 12px;
    right: 12px;
    top: calc(12px + var(--safeT));
    bottom: calc(12px + var(--safeB));
    z-index:210;
    transform: translateY(14px);
    opacity:0;
    pointer-events:none;
    transition: transform .16s ease, opacity .16s ease;
    border-radius:22px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(10,16,24,.96);
    box-shadow: 0 24px 90px rgba(0,0,0,.55);
    overflow:hidden;
    display:flex;
    flex-direction:column;
  }
  .drawer.open{opacity:1; pointer-events:auto; transform: translateY(0);}
  .drawerHead{
    padding:14px 14px;
    border-bottom:1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .drawerTitle{
    font-weight:1000;
    letter-spacing:-.02em;
  }
  .drawerBody{
    padding:12px;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    display:grid;
    gap:10px;
  }
  .slideLink{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    border-radius:16px;
    padding:12px;
    cursor:pointer;
  }
  .slideLink strong{display:block; font-weight:1000; letter-spacing:-.01em;}
  .slideLink span{display:block; margin-top:6px; color:var(--muted); font-weight:900; font-size:13px; line-height:1.3;}
  .slideLink.active{
    border-color: rgba(251,201,9,.45);
    background: linear-gradient(135deg, rgba(251,201,9,.14), rgba(58,173,187,.10));
  }

  /* ===== Layout helpers ===== */
  .grid{display:grid; gap:14px;}
  .grid2{grid-template-columns: 1.05fr .95fr;}
  @media (max-width:980px){ .grid2{grid-template-columns:1fr;} }

  .pill{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:10px 12px;
    font-weight:950;
    color: rgba(255,255,255,.88);
    display:inline-flex;
    align-items:center;
    gap:10px;
    white-space:nowrap;
  }

  .card{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(0,0,0,.16);
    overflow:hidden;
  }

  /* Media lock box */
  .mediaFrame{
    width:100%;
    height: clamp(220px, 42vh, 560px);
    background:#000;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .mediaFrame img, .mediaFrame video{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
    background:#000;
  }
  .cap{
    padding:12px 14px;
    border-top:1px solid rgba(255,255,255,.10);
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    background: rgba(0,0,0,.14);
    font-weight:1000;
  }
  .cap small{color:var(--muted2); font-weight:900; white-space:nowrap;}

  /* Start slide */
  .focusWrap{height:100%; display:flex; align-items:center; justify-content:center;}
  .focusCard{
    width:min(980px, 100%);
    border:1px solid rgba(255,255,255,.14);
    border-radius:22px;
    background: rgba(0,0,0,.16);
    padding:18px;
  }
  .focusTitle{
    font-weight:1000;
    letter-spacing:-.04em;
    font-size: clamp(24px, 3.2vw, 44px);
    margin:0 0 10px;
    line-height:1.05;
  }
  .gradText{
    background:var(--grad);
    -webkit-background-clip:text;
    background-clip:text;
    color:transparent;
    font-weight:1000;
  }
  .focusSub{color:var(--muted); font-weight:900; margin:0 0 16px; line-height:1.45;}
  .bigRedBox{
    border:1px solid rgba(255,59,48,.35);
    background: rgba(255,59,48,.10);
    border-radius:18px;
    padding:14px;
  }
  .bigLabel{
    color:rgba(255,255,255,.86);
    font-weight:1000;
    letter-spacing:.10em;
    text-transform:uppercase;
    font-size:12px;
  }
  .bigInput{
    margin-top:10px;
    width:100%;
    border-radius:18px;
    border:1px solid rgba(255,59,48,.40);
    background: rgba(0,0,0,.20);
    color: rgba(255,255,255,.98);
    font-weight:1000;
    font-size: clamp(24px, 4.5vw, 48px);
    padding:16px 16px;
    outline:none;
    min-height:64px;
    text-align:center;
  }
  .bigHint{margin-top:10px; color:rgba(255,255,255,.78); font-weight:900; line-height:1.35; font-size:13px;}
  .bigActions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; justify-content:flex-end;}

  /* Problem slide big link buttons */
  .ctaGrid{
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap:12px;
    margin-top:14px;
  }
  @media (max-width:980px){ .ctaGrid{grid-template-columns:1fr;} }
  .bigCTA{
    border:1px solid rgba(255,255,255,.16);
    border-radius:20px;
    background: rgba(255,255,255,.06);
    padding:16px;
    cursor:pointer;
    text-align:left;
    min-height:120px;
  }
  .bigCTA:hover{ background: rgba(255,255,255,.09); }
  .ctaLabel{
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-weight:1000;
    letter-spacing:.14em;
    text-transform:uppercase;
    font-size:11px;
    color: rgba(255,255,255,.86);
    margin-bottom:8px;
  }
  .ctaLabel .dotMini{width:9px;height:9px;border-radius:999px;background:var(--grad);}
  .ctaTitle{
    font-weight:1000;
    letter-spacing:-.02em;
    font-size:18px;
    line-height:1.15;
    margin:0;
  }
  .ctaDesc{
    margin-top:10px;
    color: var(--muted);
    font-weight:900;
    line-height:1.35;
    font-size:13.5px;
  }

  /* Outage slide */
  .headline{
    font-weight:1000;
    letter-spacing:-.04em;
    font-size: clamp(22px, 3vw, 38px);
    margin:0 0 10px;
    line-height:1.05;
  }
  .catch{
    display:inline-flex;
    align-items:center;
    gap:10px;
    border:1px solid rgba(251,201,9,.22);
    background: linear-gradient(135deg, rgba(251,201,9,.14), rgba(58,173,187,.10));
    padding:10px 12px;
    border-radius:999px;
    font-weight:1000;
  }
  .backupGrid{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:12px;}
  @media (max-width:980px){ .backupGrid{grid-template-columns:1fr 1fr;} }
  .backupTile{
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.16);
    border-radius:16px;
    padding:12px;
    font-weight:1000;
  }

  /* Compare tool */
  .compareTop{display:grid; grid-template-columns: repeat(3,1fr); gap:12px;}
  @media (max-width:980px){ .compareTop{grid-template-columns:1fr;} }
  .col{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(255,255,255,.04);
    overflow:hidden;
  }
  .colHead{
    padding:12px 14px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.05);
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
  }
  .colHead .label{color:var(--muted2); font-weight:1000; font-size:11px; letter-spacing:.12em; text-transform:uppercase;}
  .colHead .title{margin-top:2px; font-weight:1000; font-size:18px; letter-spacing:-.02em;}
  .tag{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:6px 10px;
    font-weight:950;
    font-size:12px;
    color: rgba(255,255,255,.86);
    white-space:nowrap;
  }
  .colBody{padding:14px; display:grid; gap:10px;}
  .klabel{
    display:block;
    color:var(--muted2);
    font-weight:1000;
    font-size:11px;
    letter-spacing:.12em;
    text-transform:uppercase;
    margin-bottom:6px;
  }
  input{
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.22);
    color: rgba(255,255,255,.96);
    font-weight:1000;
    font-size:16px;
    outline:none;
    min-height:44px;
  }
  input:focus{
    border-color: rgba(58,173,187,.72);
    box-shadow: 0 0 0 6px rgba(58,173,187,.12);
  }
  .metric{
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.16);
    border-radius:14px;
    padding:10px 12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .metric .mk{color:var(--muted2); font-weight:950; font-size:11px; letter-spacing:.12em; text-transform:uppercase;}
  .metric .mv{font-weight:1000; font-size:18px;}

  /* Year wheel */
  .yearPanel{
    margin-top:14px;
    border:1px solid rgba(255,255,255,.14);
    border-radius:22px;
    background: rgba(255,255,255,.04);
    overflow:hidden;
  }
  .yearHead{
    padding:14px 16px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: linear-gradient(135deg, rgba(251,201,9,.11), rgba(58,173,187,.09));
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .yearHead .t{font-weight:1000; letter-spacing:-.02em; display:flex; align-items:center; gap:10px;}
  .yearPill{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:8px 10px;
    font-weight:1000;
    display:flex;
    align-items:center;
    gap:10px;
    white-space:nowrap;
  }
  .yearPill .dot2{width:10px;height:10px;border-radius:999px;background:var(--grad);}

  .yearBody{
    padding:16px;
    display:grid;
    grid-template-columns: .9fr 1.1fr;
    gap:12px;
  }
  @media (max-width:980px){ .yearBody{grid-template-columns:1fr;} }

  .wheelBox{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:18px;
    padding:14px;
    display:grid;
    gap:12px;
  }
  .wheelTop{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;}
  .yearBig{font-size: clamp(46px, 6.6vw, 78px); font-weight:1000; letter-spacing:-.05em; line-height:1;}
  .dialBtns{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .miniBtn{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:var(--text);
    border-radius:14px;
    padding:10px 12px;
    font-weight:950;
    min-height:44px;
    cursor:pointer;
  }

  .wheel{
    position:relative;
    height:220px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.20);
    overflow:hidden;
  }
  .wheel::before{
    content:"";
    position:absolute;
    inset:0;
    background: linear-gradient(180deg, rgba(11,16,23,.92), transparent 26%, transparent 74%, rgba(11,16,23,.92));
    pointer-events:none;
    z-index:2;
  }
  .wheel::after{
    content:"";
    position:absolute;
    left:10px; right:10px;
    top: calc(50% - 22px);
    height:44px;
    border-radius:14px;
    border:1px solid rgba(251,201,9,.24);
    pointer-events:none;
    z-index:3;
  }

  .wheelList{
    height:100%;
    overflow-y:auto;
    scroll-snap-type:y mandatory;
    -webkit-overflow-scrolling: touch;
    padding: 88px 0;
    margin:0;
  }
  .wheelList::-webkit-scrollbar{ width: 0; height:0; }
  .wheelItem{
    height:44px;
    display:flex;
    align-items:center;
    justify-content:center;
    scroll-snap-align:center;
    font-weight:1000;
    font-size:20px;
    letter-spacing:-.01em;
    color: rgba(255,255,255,.72);
    user-select:none;
  }
  .wheelItem.active{
    color: rgba(255,255,255,.96);
    text-shadow: 0 10px 32px rgba(0,0,0,.35);
  }

  .yearCompare{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:18px;
    padding:14px;
    display:grid;
    gap:12px;
  }
  .bigMoneyGrid{display:grid; grid-template-columns: repeat(3,1fr); gap:10px;}
  @media (max-width:980px){ .bigMoneyGrid{grid-template-columns:1fr;} }

  .bigTile{
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.04);
    border-radius:18px;
    padding:12px;
  }
  .bigTile .bk{
    color:var(--muted2);
    font-weight:1000;
    font-size:11px;
    letter-spacing:.12em;
    text-transform:uppercase;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .chip{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:6px 10px;
    font-weight:950;
    color: rgba(255,255,255,.86);
    white-space:nowrap;
    font-size:12px;
  }
  .bigTile .m{
    margin-top:10px;
    font-size: clamp(34px, 5.4vw, 58px);
    font-weight:1000;
    letter-spacing:-.035em;
    line-height:1;
  }
  .bigTile .a{
    margin-top:8px;
    color:var(--muted);
    font-weight:900;
    font-size:13px;
  }
  .yearSavings{
    border:1px solid rgba(52,199,89,.28);
    background: rgba(52,199,89,.10);
    border-radius:16px;
    padding:10px 12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
    font-weight:1000;
  }
  .yearSavings .v{font-size:18px; color: var(--opt1); letter-spacing:-.01em;}

  /* Timeline (interactive) */
  .timeline{
    display:grid;
    grid-template-columns: repeat(6,1fr);
    gap:10px;
  }
  @media (max-width:980px){ .timeline{grid-template-columns:1fr;} }
  .step{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.16);
    border-radius:18px;
    padding:14px;
    min-height:112px;
    cursor:pointer;
    transition: border-color .15s ease, background .15s ease, transform .12s ease;
  }
  .step:hover{ transform: translateY(-1px); }
  .step.active{
    border-color: rgba(251,201,9,.55);
    background: linear-gradient(135deg, rgba(251,201,9,.14), rgba(58,173,187,.10));
  }
  .num{
    width:30px;height:30px;border-radius:12px;
    background: var(--grad);
    color:#07121b;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:1000;
    margin-bottom:10px;
  }
  .step .t{font-weight:1000; letter-spacing:-.02em;}
  .step .d{margin-top:8px; color: rgba(255,255,255,.78); font-weight:900;}
</style>
</head>

<body>

<!-- Fullscreen (desktop/tablet). Mobile uses menu. -->
<button class="btn fsBtn" id="btnFS" type="button">Fullscreen</button>

<!-- Topbar -->
<div class="topbar">
  <div class="topbarInner">
    <div class="brand">
      <img id="logoImg" alt="Logo"/>
      <div class="brandTitle">
        <div class="name"><span class="dot"></span> Leverage Our Sun</div>
        <div class="sub">Solar + Storage Closing Tool</div>
      </div>
    </div>

    <!-- Mobile controls -->
    <div class="mobileControls">
      <button class="hamburger" id="btnMenu" type="button">Menu</button>
      <button class="hamburger" id="btnResetMobile" type="button">Reset</button>
    </div>

    <!-- Desktop nav -->
    <div class="nav">
      <button class="btn" id="btnHome" type="button">Start</button>
      <button class="btn" id="btnPrevTop" type="button">Prev</button>
      <button class="btn primary" id="btnNextTop" type="button">Next</button>
      <button class="btn danger" id="btnReset" type="button">Reset</button>
    </div>
  </div>
  <div class="progressWrap">
    <div class="progress"><div id="progressFill"></div></div>
  </div>
</div>

<div class="badge">
  <span class="dot"></span>
  <span class="t" id="slideCounter">Slide 1 / 1</span>
</div>

<!-- Mobile slide drawer -->
<div class="drawerOverlay" id="drawerOverlay"></div>
<div class="drawer" id="drawer">
  <div class="drawerHead">
    <div class="drawerTitle">Presentation Menu</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button class="btn" id="btnFSMenu" type="button">Fullscreen</button>
      <button class="btn danger" id="btnCloseMenu" type="button">Close</button>
    </div>
  </div>
  <div class="drawerBody" id="drawerBody"></div>
</div>

<div class="deck">
  <div class="stage" id="stage">

    <!-- SLIDE 1: START INPUT -->
    <section class="slide active" data-slide data-title="Start" data-sub="Enter average bill to populate calculator">
      <div class="slideHead">
        <h2><span class="spark"></span> Customer Starting Point</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Feeds the calculator</span>
        </div>
      </div>
      <div class="slideBody">
        <div class="focusWrap">
          <div class="focusCard">
            <h1 class="focusTitle">What is your <span class="gradText">average</span> monthly Edison bill?</h1>
            <p class="focusSub">Enter the customer’s average monthly payment. This automatically populates the Utility column in the comparison tool.</p>

            <div class="bigRedBox">
              <div class="bigLabel">Average monthly utility payment (USD)</div>
              <input class="bigInput" id="startBill" inputmode="decimal" value="458" aria-label="Average monthly utility bill"/>
              <div class="bigHint">Use the average of the last 12 months if it varies.</div>
            </div>

            <div class="bigActions">
              <button class="btn" type="button" onclick="go(1)">See Rate Problem</button>
              <button class="btn primary" type="button" onclick="go(2)">Outage Demo</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 2: PROBLEM + LINKS -->
    <section class="slide" data-slide data-title="Rate Problem" data-sub="TOU, 13% increase, LA fires (links)">
      <div class="slideHead">
        <h2><span class="spark"></span> The Problem</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Rates: $0.17 → $0.42 / kWh</span>
        </div>
      </div>

      <div class="slideBody">
        <div class="grid grid2">
          <div class="card">
            <div class="mediaFrame">
              <img id="imgBillNoSolar" alt="Bill without solar (SCE)" />
            </div>
            <div class="cap">
              <div>Bill example (no solar)</div>
              <small>Locked for presentation</small>
            </div>
          </div>

          <div class="card" style="padding:16px;">
            <div style="color:var(--muted2);font-weight:1000;font-size:11px;letter-spacing:.12em;text-transform:uppercase;">Why it’s expensive</div>
            <div style="margin-top:10px;font-weight:1000;font-size:clamp(22px,3vw,38px);letter-spacing:-.045em;line-height:1.06;">
              It’s not only <span class="gradText">how much</span> — it’s <span class="gradText">when</span>.
            </div>
            <div style="margin-top:10px;color:var(--muted);font-weight:900;line-height:1.5;font-size:14.5px;">
              Time-of-Use (TOU) pricing charges more when the grid is stressed. That “peak window” is where bills explode.
              Batteries change the game by shifting energy away from peak purchases.
            </div>

            <div class="ctaGrid">
              <div class="bigCTA" onclick="popupArticle(ASSETS.linkTOU)">
                <div class="ctaLabel"><span class="dotMini"></span> TOU</div>
                <div class="ctaTitle">SCE Time-of-Use Rates</div>
                <div class="ctaDesc">Official TOU rate plans and time-of-day pricing.</div>
              </div>

              <div class="bigCTA" onclick="popupArticle(ASSETS.linkSCE)">
                <div class="ctaLabel"><span class="dotMini"></span> 13% increase</div>
                <div class="ctaTitle">SCE: Understanding bill updates</div>
                <div class="ctaDesc">Why charges change and what updates mean on the bill.</div>
              </div>

              <div class="bigCTA" onclick="popupArticle(ASSETS.linkLAT)">
                <div class="ctaLabel"><span class="dotMini"></span> L.A fires</div>
                <div class="ctaTitle">LA Times: Edison rate case</div>
                <div class="ctaDesc">Context on the rate case and drivers behind increases.</div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 3: OUTAGE DEMO -->
    <section class="slide" data-slide data-title="Outage Demo" data-sub="Backup essentials + Tesla VPP links">
      <div class="slideHead">
        <h2><span class="spark"></span> Outage Demo</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
          <span class="catch"><span class="dot"></span> Win the day, own the night</span>
        </div>
      </div>

      <div class="slideBody">
        <div class="grid grid2">
          <div class="card">
            <div class="mediaFrame">
              <video id="outageVid" controls playsinline preload="metadata"></video>
            </div>
            <div class="cap">
              <div>Home powered during outage</div>
              <small>Plays inline on iPhone</small>
            </div>
          </div>

          <div class="card" style="padding:16px;">
            <div class="headline">Major things you can back up</div>
            <div style="color:var(--muted);font-weight:900;line-height:1.45;">
              The same batteries that cut peak costs also keep essentials running during outages.
            </div>

            <div class="backupGrid">
              <div class="backupTile">Lights + outlets</div>
              <div class="backupTile">Wi-Fi + internet</div>
              <div class="backupTile">Refrigerator / freezer</div>
              <div class="backupTile">Security + cameras</div>
              <div class="backupTile">Garage door</div>
              <div class="backupTile">Selective HVAC</div>
            </div>

            <div style="display:grid;gap:10px;margin-top:14px;">
              <button class="btn primary" type="button" onclick="openExternal(ASSETS.linkTeslaVPP)">
                Tesla Virtual Power Plant
              </button>
              <button class="btn" type="button" onclick="openExternal(ASSETS.linkTeslaVPP_SCE)">
                Tesla VPP (SCE page)
              </button>
              <button class="btn" type="button" onclick="openExternal(ASSETS.linkPowerwall)">
                Powerwall overview
              </button>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 4: PROOF -->
    <section class="slide" data-slide data-title="Proof ($28 Bill)" data-sub="Why the bill can be low with storage">
      <div class="slideHead">
        <h2><span class="spark"></span> Proof</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Solar + Storage Net Bill</span>
        </div>
      </div>

      <div class="slideBody">
        <div class="grid grid2">
          <div class="card">
            <div class="mediaFrame">
              <img id="imgBillSolar" alt="Bill on solar (SCE net billing example)" />
            </div>
            <div class="cap">
              <div>Bill example (solar + storage)</div>
              <small>Locked for presentation</small>
            </div>
          </div>

          <div class="card" style="padding:16px;">
            <div style="color:var(--muted2);font-weight:1000;font-size:11px;letter-spacing:.12em;text-transform:uppercase;">Why it can be low</div>
            <div style="margin-top:10px;font-weight:1000;font-size:clamp(22px,3vw,38px);letter-spacing:-.045em;line-height:1.06;">
              Solar runs the day. Batteries protect the <span class="gradText">expensive</span> hours.
            </div>
            <div style="margin-top:10px;color:var(--muted);font-weight:900;line-height:1.5;font-size:14.5px;">
              Solar offsets daytime purchases. Batteries discharge during peak hours so you buy less at the highest prices.
              The grid becomes backup instead of primary.
            </div>

            <div style="display:grid;gap:10px;margin-top:14px;">
              <div class="metric">
                <div class="mk">Simple way to say it</div>
                <div class="mv" style="color:var(--opt1);">Less peak buying = lower net bill</div>
              </div>
              <div class="metric">
                <div class="mk">What remains on most bills</div>
                <div class="mv">Minimum charges + small net usage</div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 5: COMPARE TOOL -->
    <section class="slide" data-slide data-title="Compare" data-sub="3 options + synced year wheel">
      <div class="slideHead">
        <h2><span class="spark"></span> Compare</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button class="btn" type="button" onclick="setYear(1,true)">Year 1</button>
          <button class="btn" type="button" onclick="setYear(5,true)">Year 5</button>
          <button class="btn" type="button" onclick="setYear(10,true)">Year 10</button>
          <button class="btn" type="button" onclick="setYear(25,true)">Year 25</button>
        </div>
      </div>

      <div class="slideBody">
        <div class="compareTop">
          <!-- Utility -->
          <div class="col">
            <div class="colHead" style="background:linear-gradient(180deg, rgba(255,59,48,.18), rgba(255,255,255,.05));">
              <div>
                <div class="label">Utility</div>
                <div class="title">Edison</div>
              </div>
              <span class="tag">Red</span>
            </div>
            <div class="colBody">
              <label><span class="klabel">Avg monthly bill ($)</span><input id="uPay" inputmode="decimal" value="458"></label>
              <label><span class="klabel">Annual increase (%)</span><input id="uEsc" inputmode="decimal" value="9"></label>
              <div class="metric">
                <div class="mk">25-year utility spend</div>
                <div class="mv" id="uTotal" style="color:var(--utility)">$0</div>
              </div>
            </div>
          </div>

          <!-- Option 1 -->
          <div class="col">
            <div class="colHead" style="background:linear-gradient(180deg, rgba(52,199,89,.16), rgba(255,255,255,.05));">
              <div>
                <div class="label">Option 1</div>
                <div class="title">Proposal A</div>
              </div>
              <span class="tag">Green</span>
            </div>
            <div class="colBody">
              <label><span class="klabel">Avg monthly payment ($)</span><input id="aPay" inputmode="decimal" value="295"></label>
              <label><span class="klabel">Annual escalator (%)</span><input id="aEsc" inputmode="decimal" value="0"></label>
              <div class="metric">
                <div class="mk">Total savings over 25 years</div>
                <div class="mv" id="aSave25" style="color:var(--opt1)">$0</div>
              </div>
            </div>
          </div>

          <!-- Option 2 -->
          <div class="col">
            <div class="colHead" style="background:linear-gradient(180deg, rgba(0,194,255,.16), rgba(255,255,255,.05));">
              <div>
                <div class="label">Option 2</div>
                <div class="title">Proposal B</div>
              </div>
              <span class="tag">Cyan</span>
            </div>
            <div class="colBody">
              <label><span class="klabel">Avg monthly payment ($)</span><input id="bPay" inputmode="decimal" value="325"></label>
              <label><span class="klabel">Annual escalator (%)</span><input id="bEsc" inputmode="decimal" value="0"></label>
              <div class="metric">
                <div class="mk">Total savings over 25 years</div>
                <div class="mv" id="bSave25" style="color:var(--opt2)">$0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="yearPanel">
          <div class="yearHead">
            <div class="t"><span class="spark"></span> Annual payment comparison (synced year)</div>
            <div class="yearPill"><span class="dot2"></span> Year <span id="yearChip">1</span></div>
          </div>

          <div class="yearBody">
            <div class="wheelBox">
              <div class="wheelTop">
                <div class="yearBig" id="yearBig">1</div>
                <div class="dialBtns">
                  <button class="miniBtn" type="button" id="yearMinus">−1</button>
                  <button class="miniBtn" type="button" id="yearPlus">+1</button>
                </div>
              </div>

              <div class="wheel">
                <div class="wheelList" id="yearWheel"></div>
              </div>

              <div style="color:var(--muted); font-weight:900; font-size:13px;">
                Scroll the year wheel. All 3 options update together.
              </div>
            </div>

            <div class="yearCompare">
              <div class="bigMoneyGrid">
                <div class="bigTile">
                  <div class="bk">Utility <span class="chip">Red</span></div>
                  <div class="m" id="uM" style="color:var(--utility)">$0.00</div>
                  <div class="a" id="uY">Annual: $0</div>
                </div>

                <div class="bigTile">
                  <div class="bk">Option 1 <span class="chip">Green</span></div>
                  <div class="m" id="aM" style="color:var(--opt1)">$0.00</div>
                  <div class="a" id="aY">Annual: $0</div>
                </div>

                <div class="bigTile">
                  <div class="bk">Option 2 <span class="chip">Cyan</span></div>
                  <div class="m" id="bM" style="color:var(--opt2)">$0.00</div>
                  <div class="a" id="bY">Annual: $0</div>
                </div>
              </div>

              <div class="yearSavings">
                <div>Best option savings vs utility (annual)</div>
                <div class="v" id="bestAnnual">$0</div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </section>

    <!-- SLIDE 6: TIMELINE -->
    <section class="slide" data-slide data-title="Timeline" data-sub="Tap steps to explain process">
      <div class="slideHead">
        <h2><span class="spark"></span> Timeline</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <a class="btn" target="_blank" rel="noreferrer" href="https://www.sunup-energy.com">sunup-energy.com</a>
          <a class="btn" target="_blank" rel="noreferrer" href="https://fulfillpower.com">fulfillpower.com</a>
          <a class="btn primary" target="_blank" rel="noreferrer"
             href="https://www.google.com/search?client=safari&hs=XBx9&sca_esv=73cfac6e472fb041&hl=en-us&sxsrf=ANbL-n5pIhFe5d5WvDJM7Q0KFrq6PCcSHA:1770166523563&si=AL3DRZEsmMGCryMMFSHJ3StBhOdZ2-6yYkXd_doETEE1OR-qOXnP5y33p_1DfpRctiz00a&q=SunUp+Energy+Reviews&sa=X&dlnr=1">Reviews</a>
        </div>
      </div>

      <div class="slideBody">
        <div class="timeline" id="timeline">
          <div class="step active" data-step="0"><div class="num">1</div><div class="t">Site Survey</div><div class="d">&lt; 1 week</div></div>
          <div class="step" data-step="1"><div class="num">2</div><div class="t">Engineering</div><div class="d">~ 1 week</div></div>
          <div class="step" data-step="2"><div class="num">3</div><div class="t">Permits</div><div class="d">1–12 weeks</div></div>
          <div class="step" data-step="3"><div class="num">4</div><div class="t">Install</div><div class="d">1 day – 2 weeks</div></div>
          <div class="step" data-step="4"><div class="num">5</div><div class="t">Inspection</div><div class="d">1–2 weeks</div></div>
          <div class="step" data-step="5"><div class="num">6</div><div class="t">PTO</div><div class="d">30–60 days</div></div>
        </div>

        <div class="card" style="margin-top:16px;padding:18px" id="timelineExplain"></div>
      </div>
    </section>

  </div>
</div>

<!-- Bottom dock controls -->
<div class="presentBar">
  <div class="dock">
    <button class="btn" id="btnPrev" type="button">Prev</button>
    <button class="btn" id="btnStartDock" type="button">Start</button>
    <button class="btn primary" id="btnNext" type="button">Next</button>
  </div>
</div>

<script>
/*
  Put these files in the SAME folder as index.html:

  - 4A5B0E0C-50D9-4752-8469-F61A667110D8.png   (logo)
  - Outagevideo.mp4
  - Scebill.jpeg
  - IMG_9100.jpeg
*/

const ASSETS = {
  logo: "4A5B0E0C-50D9-4752-8469-F61A667110D8.png",
  billNoSolar: "Scebill.jpeg",
  billSolar: "IMG_9100.jpeg",
  outageVideo: "Outagevideo.mp4",

  linkTOU: "https://www.sce.com/residential/rates/Time-Of-Use-Residential-Rate-Plans",
  linkSCE: "https://www.sce.com/save-money/rates-financing/residential-rate-plans/understanding-updates-to-your-bill",
  linkLAT: "https://www.latimes.com/business/story/2025-05-22/edison-general-rate-case",

  linkTeslaVPP: "https://www.tesla.com/support/energy/virtual-power-plant",
  linkTeslaVPP_SCE: "https://www.tesla.com/support/energy/virtual-power-plant/sce",
  linkPowerwall: "https://www.tesla.com/powerwall"
};

const $ = (id)=>document.getElementById(id);

/* Slides */
let slides = [];
let idx = 0;

function refreshSlides(){ slides = Array.from(document.querySelectorAll("[data-slide]")); }

function updateHUD(){
  const pct = (idx / Math.max(1, slides.length-1)) * 100;
  $("progressFill").style.width = `${pct}%`;
  const c = $("slideCounter");
  if(c) c.textContent = `Slide ${idx+1} / ${slides.length}`;
  buildDrawerList(); // keep menu in sync
}

function activate(i){
  refreshSlides();
  idx = Math.max(0, Math.min(slides.length-1, i));
  slides.forEach((s, n)=> s.classList.toggle("active", n === idx));
  updateHUD();
  const b = slides[idx].querySelector(".slideBody");
  if(b) b.scrollTop = 0;
}

function next(){ activate(idx+1); }
function prev(){ activate(idx-1); }
function go(i){ activate(i); closeDrawer(); }
window.go = go;

/* Top controls (desktop) */
$("btnNext")?.addEventListener("click", next);
$("btnPrev")?.addEventListener("click", prev);
$("btnNextTop")?.addEventListener("click", next);
$("btnPrevTop")?.addEventListener("click", prev);
$("btnHome")?.addEventListener("click", ()=>activate(0));
$("btnStartDock")?.addEventListener("click", ()=>activate(0));

document.addEventListener("keydown", (e)=>{
  if(e.key === "ArrowRight" || e.key === " " || e.key === "PageDown"){ e.preventDefault(); next(); }
  if(e.key === "ArrowLeft"  || e.key === "PageUp"){ e.preventDefault(); prev(); }
});

/* Fullscreen */
function toggleFS(){
  const el = document.documentElement;
  if(!document.fullscreenElement){
    el.requestFullscreen?.();
  }else{
    document.exitFullscreen?.();
  }
}
$("btnFS")?.addEventListener("click", toggleFS);
$("btnFSMenu")?.addEventListener("click", toggleFS);

/* External open */
function openExternal(url){
  window.open(url, "_blank", "noopener,noreferrer");
}
window.openExternal = openExternal;

/* Popup */
function popupArticle(url){
  const w = Math.min(1100, Math.floor(screen.width * 0.92));
  const h = Math.min(820,  Math.floor(screen.height * 0.88));
  const left = Math.max(0, Math.floor((screen.width - w) / 2));
  const top  = Math.max(0, Math.floor((screen.height - h) / 2));
  const win = window.open(url, "LOS_POP", `popup=yes,scrollbars=yes,resizable=yes,width=${w},height=${h},left=${left},top=${top}`);
  if(win) win.focus();
  else openExternal(url);
}
window.popupArticle = popupArticle;

/* Start slide -> Utility bill sync */
function syncStartBillToCalculator(){
  const v = $("startBill").value;
  $("uPay").value = v;
  recalc();
}
$("startBill").addEventListener("input", syncStartBillToCalculator, {passive:true});

/* Calculator + wheel */
let year = 1;
let cache = { u:[], a:[], b:[], uTotal:0, aTotal:0, bTotal:0 };

function toNumber(v){
  const n = parseFloat(String(v).replace(/[^0-9.\-]/g,""));
  return Number.isFinite(n) ? n : 0;
}
function money0(n){ return (Number.isFinite(n)?n:0).toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0}); }
function money2(n){ return (Number.isFinite(n)?n:0).toLocaleString(undefined,{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}); }

function monthlySeries(baseMonthly, escPct, years=25){
  const r = escPct/100;
  const out = [];
  for(let y=1;y<=years;y++) out.push(baseMonthly * Math.pow(1+r, y-1));
  return out;
}
function totalSeries(series){ return series.reduce((s,m)=> s + (m*12), 0); }
function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

function recalc(){
  const uPay = toNumber($("uPay").value);
  const uEsc = toNumber($("uEsc").value);
  const aPay = toNumber($("aPay").value);
  const aEsc = toNumber($("aEsc").value);
  const bPay = toNumber($("bPay").value);
  const bEsc = toNumber($("bEsc").value);

  cache.u = monthlySeries(uPay, uEsc);
  cache.a = monthlySeries(aPay, aEsc);
  cache.b = monthlySeries(bPay, bEsc);

  cache.uTotal = totalSeries(cache.u);
  cache.aTotal = totalSeries(cache.a);
  cache.bTotal = totalSeries(cache.b);

  $("uTotal").textContent = money0(cache.uTotal);
  $("aSave25").textContent = money0(cache.uTotal - cache.aTotal);
  $("bSave25").textContent = money0(cache.uTotal - cache.bTotal);

  setYear(year, true);
}

function setYear(newYear, snapWheel){
  year = clamp(parseInt(newYear,10)||1, 1, 25);
  $("yearBig").textContent = String(year);
  $("yearChip").textContent = String(year);

  const i = year - 1;
  const uM = cache.u[i] || 0;
  const aM = cache.a[i] || 0;
  const bM = cache.b[i] || 0;

  $("uM").textContent = money2(uM);
  $("aM").textContent = money2(aM);
  $("bM").textContent = money2(bM);

  $("uY").textContent = `Annual: ${money0(uM*12)}`;
  $("aY").textContent = `Annual: ${money0(aM*12)}`;
  $("bY").textContent = `Annual: ${money0(bM*12)}`;

  const best = Math.min(aM, bM);
  const bestAnnual = (uM - best) * 12;
  $("bestAnnual").textContent = money0(bestAnnual);
  $("bestAnnual").style.color = (bestAnnual >= 0) ? "var(--opt1)" : "var(--utility)";

  const wheel = $("yearWheel");
  if(wheel){
    const items = wheel.querySelectorAll(".wheelItem");
    items.forEach((el, idx)=> el.classList.toggle("active", idx === i));
    if(snapWheel){
      const target = items[i];
      if(target){
        const top = target.offsetTop - (wheel.clientHeight/2 - target.clientHeight/2);
        wheel.scrollTo({ top, behavior: "auto" });
      }
    }
  }
}
window.setYear = setYear;

function buildYearWheel(){
  const wheel = $("yearWheel");
  wheel.innerHTML = "";
  for(let y=1;y<=25;y++){
    const div = document.createElement("div");
    div.className = "wheelItem" + (y===1 ? " active" : "");
    div.textContent = `Year ${y}`;
    div.addEventListener("click", ()=>setYear(y, true));
    wheel.appendChild(div);
  }

  const ITEM_H = 44;
  const PAD = 88;
  let ticking = false;

  wheel.addEventListener("scroll", ()=>{
    if(ticking) return;
    ticking = true;
    requestAnimationFrame(()=>{
      ticking = false;
      const center = wheel.scrollTop + (wheel.clientHeight/2);
      const pos = center - PAD - (ITEM_H/2);
      const idx = clamp(Math.round(pos / ITEM_H), 0, 24);
      const newYear = idx + 1;
      if(newYear !== year) setYear(newYear, false);
    });
  }, {passive:true});

  $("yearMinus").onclick = ()=>setYear(year-1, true);
  $("yearPlus").onclick  = ()=>setYear(year+1, true);

  ["uPay","uEsc","aPay","aEsc","bPay","bEsc"].forEach(id=>{
    $(id).addEventListener("input", recalc, {passive:true});
  });

  $("uPay").value = $("startBill").value;
  recalc();
  setYear(1, true);
}

/* Reset */
function hardReset(){
  $("startBill").value="458";
  $("uPay").value="458"; $("uEsc").value="9";
  $("aPay").value="295"; $("aEsc").value="0";
  $("bPay").value="325"; $("bEsc").value="0";
  year = 1;
  recalc();
  activate(0);
}
$("btnReset")?.addEventListener("click", hardReset);
$("btnResetMobile")?.addEventListener("click", hardReset);

/* Timeline explanations */
const TIMELINE_TEXT = [
  { title:"Site Survey", body:"A quick visit to confirm roof condition, electrical layout, and equipment placement. This ensures pricing and design accuracy before permits.", why:"Prevents redesigns and delays later" },
  { title:"Engineering", body:"Engineers design the system to meet utility and city requirements. Structural, electrical, and fire safety rules are verified here.", why:"Required for permits and utility approval" },
  { title:"Permits", body:"City and utility review the plans. Timing varies by jurisdiction — this is usually the longest step.", why:"This step is out of the homeowner’s control, but it protects your investment" },
  { title:"Installation", body:"Panels, batteries, and electrical work are installed. Most homes are completed in 1–2 days once scheduled.", why:"The visible transformation happens here" },
  { title:"Inspection", body:"City verifies the installation meets code. Minor corrections, if any, are handled quickly.", why:"Final approval before utility permission" },
  { title:"Permission to Operate (PTO)", body:"The utility grants approval to turn the system on. First payment typically occurs one month after PTO.", why:"This is when savings officially begin" }
];

function initTimeline(){
  const steps = Array.from(document.querySelectorAll(".step[data-step]"));
  const box = $("timelineExplain");
  if(!steps.length || !box) return;

  function render(i){
    const data = TIMELINE_TEXT[i] || TIMELINE_TEXT[0];
    box.innerHTML = `
      <div style="font-weight:1000;font-size:clamp(20px,2.5vw,32px);letter-spacing:-.03em">
        ${data.title}
      </div>
      <p style="margin:10px 0 0;color:var(--muted);font-weight:900;line-height:1.45">
        ${data.body}
      </p>
      <div class="metric" style="margin-top:14px">
        <div class="mk">Why this matters</div>
        <div class="mv">${data.why}</div>
      </div>
      <div class="metric" style="margin-top:10px">
        <div class="mk">Impactful note</div>
        <div class="mv" style="color:var(--opt1)">Clear timelines reduce stress and protect your project</div>
      </div>
      <div style="margin-top:10px;color:rgba(255,255,255,.78);font-weight:900;line-height:1.4;font-size:13px;">
        First payment is typically <strong>one month after PTO</strong> — not at install.
      </div>
    `;
  }

  render(0);

  steps.forEach(step=>{
    step.addEventListener("click", ()=>{
      steps.forEach(s=>s.classList.remove("active"));
      step.classList.add("active");
      render(Number(step.dataset.step));
    });
  });
}

/* ===== Mobile Drawer Menu ===== */
const drawer = $("drawer");
const overlay = $("drawerOverlay");
const drawerBody = $("drawerBody");

function openDrawer(){
  overlay.classList.add("open");
  drawer.classList.add("open");
  buildDrawerList();
}
function closeDrawer(){
  overlay.classList.remove("open");
  drawer.classList.remove("open");
}
function buildDrawerList(){
  if(!drawerBody) return;
  drawerBody.innerHTML = "";
  slides.forEach((s, i)=>{
    const title = s.getAttribute("data-title") || `Slide ${i+1}`;
    const sub = s.getAttribute("data-sub") || "";
    const item = document.createElement("div");
    item.className = "slideLink" + (i===idx ? " active" : "");
    item.innerHTML = `<strong>${title}</strong><span>${sub}</span>`;
    item.addEventListener("click", ()=>go(i));
    drawerBody.appendChild(item);
  });
  // quick actions
  const hr = document.createElement("div");
  hr.style.height="1px";
  hr.style.background="rgba(255,255,255,.10)";
  hr.style.margin="6px 0";
  drawerBody.appendChild(hr);

  const quick = document.createElement("div");
  quick.className = "slideLink";
  quick.innerHTML = `<strong>Reset Presentation</strong><span>Clear values and return to Start.</span>`;
  quick.addEventListener("click", ()=>{ hardReset(); closeDrawer(); });
  drawerBody.appendChild(quick);
}

$("btnMenu")?.addEventListener("click", openDrawer);
$("btnCloseMenu")?.addEventListener("click", closeDrawer);
overlay?.addEventListener("click", closeDrawer);

/* Boot */
(function init(){
  refreshSlides();

  $("logoImg").src = ASSETS.logo;
  $("imgBillNoSolar").src = ASSETS.billNoSolar;
  $("imgBillSolar").src = ASSETS.billSolar;

  const v = $("outageVid");
  v.src = ASSETS.outageVideo;
  v.load();

  buildYearWheel();
  initTimeline();
  activate(0);
})();
</script>
</body>
</html>
