<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Solar + Storage Closing Tool</title>
<meta name="theme-color" content="#0b1017"/>

<style>
  :root{
    --navy:#0b1017;
    --navy2:#06122a;
    --gold:#FBC909;
    --teal:#3AADBB;

    --utility:#ff3b30;
    --opt1:#34c759;
    --opt2:#00c2ff;

    --text:rgba(255,255,255,.96);
    --muted:rgba(255,255,255,.72);
    --muted2:rgba(255,255,255,.56);
    --border:rgba(255,255,255,.14);

    --grad:linear-gradient(135deg,var(--gold),var(--teal));
    --r:16px;
    --r2:22px;

    --safeT: env(safe-area-inset-top);
    --safeB: env(safe-area-inset-bottom);
    --safeL: env(safe-area-inset-left);
    --safeR: env(safe-area-inset-right);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background: linear-gradient(180deg, var(--navy2), var(--navy)); /* iPhone-safe */
    overflow:hidden;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  a{color:#cfe8ff;text-decoration:none}
  a:hover{text-decoration:underline}
  button, a, input { -webkit-tap-highlight-color: transparent; }

  /* Top bar */
  .topbar{
    position:fixed; inset:0 0 auto 0;
    z-index:100;
    padding-top:var(--safeT);
    background: rgba(10,16,24,.92);
    border-bottom:1px solid rgba(255,255,255,.12);
  }
  .topbarInner{
    max-width:1280px;
    margin:0 auto;
    padding:12px 16px;
    padding-left: calc(16px + var(--safeL));
    padding-right: calc(16px + var(--safeR));
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .brand{display:flex; align-items:center; gap:12px; min-width:260px;}
  .brand img{height:40px; width:auto; display:block;}
  .brandTitle{display:flex; flex-direction:column; line-height:1.1}
  .brandTitle .name{font-weight:1000; letter-spacing:-.02em; display:flex; align-items:center; gap:10px;}
  .dot{width:10px;height:10px;border-radius:999px;background:var(--grad);}
  .brandTitle .sub{font-size:12px; color:var(--muted2); margin-top:3px; letter-spacing:.02em;}

  .nav{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;}
  .btn{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:var(--text);
    padding:11px 14px;
    border-radius:14px;
    font-weight:950;
    cursor:pointer;
    min-height:44px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    user-select:none;
  }
  .btn.primary{background:var(--grad); color:#07121b; border-color: rgba(255,255,255,.18);}
  .btn.danger{border-color: rgba(255,59,48,.25); background: rgba(255,59,48,.10);}

  .progressWrap{
    max-width:1280px; margin:0 auto;
    padding: 0 16px 10px;
    padding-left: calc(16px + var(--safeL));
    padding-right: calc(16px + var(--safeR));
  }
  .progress{
    height:7px;border-radius:999px;
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
  }
  .progress > div{height:100%; width:0%; background:var(--grad); transition: width .12s linear;}

  .badge{
    position:fixed;
    top: calc(12px + var(--safeT));
    right: 12px;
    z-index:120;
    display:flex;
    align-items:center;
    gap:10px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.24);
    border-radius:999px;
    padding:10px 12px;
  }
  .badge .t{font-weight:1000; color: rgba(255,255,255,.90); font-size:13px; letter-spacing:-.02em;}

  /* Deck */
  .deck{
    height:100%;
    padding-top: calc(96px + var(--safeT));
    padding-bottom: calc(12px + var(--safeB));
    display:flex;
    align-items:stretch;
    justify-content:center;
  }
  .stage{
    width:min(1280px, 100vw);
    height:100%;
    padding: 14px 16px;
    padding-left: calc(16px + var(--safeL));
    padding-right: calc(16px + var(--safeR));
    position:relative;
  }
  .slide{
    position:absolute;
    inset:14px 16px;
    inset-left: calc(16px + var(--safeL));
    inset-right: calc(16px + var(--safeR));
    border:1px solid rgba(255,255,255,.14);
    border-radius: var(--r2);
    background: rgba(255,255,255,.05);
    overflow:hidden;
    opacity:0;
    transform: translateY(8px);
    pointer-events:none;
    transition: opacity .12s linear, transform .12s linear;
  }
  .slide.active{
    opacity:1;
    transform: translateY(0);
    pointer-events:auto;
  }

  .slideHead{
    padding:16px 18px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.05);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }
  .slideHead h2{
    margin:0;
    font-size: 15px;
    letter-spacing:.04em;
    text-transform:uppercase;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .spark{width:10px;height:10px;border-radius:999px;background:var(--grad);}

  .slideBody{
    padding:18px;
    height: calc(100% - 58px);
    overflow:auto;
    -webkit-overflow-scrolling: touch;
  }

  .presentBar{
    position:fixed;
    left: 12px;
    right: 12px;
    bottom: calc(12px + var(--safeB));
    z-index:120;
    display:flex;
    justify-content:center;
    gap:10px;
    pointer-events:none;
  }
  .presentBar .btn{pointer-events:auto;}

  /* Layout */
  .grid{display:grid; gap:14px;}
  .grid2{grid-template-columns: 1.05fr .95fr;}
  .grid2eq{grid-template-columns:1fr 1fr;}
  @media (max-width:980px){ .grid2, .grid2eq{grid-template-columns:1fr;} }

  .pill{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:10px 12px;
    font-weight:950;
    color: rgba(255,255,255,.88);
    display:inline-flex;
    align-items:center;
    gap:10px;
    white-space:nowrap;
  }

  .hero{
    height:100%;
    display:grid;
    grid-template-columns: 1.18fr .82fr;
    gap:14px;
    align-items:stretch;
  }
  @media (max-width: 980px){ .hero{ grid-template-columns:1fr; } }

  .heroCard{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(0,0,0,.14);
    padding:18px;
  }
  .heroCard h1{
    margin:0;
    font-size: clamp(28px, 4.3vw, 58px);
    letter-spacing:-.055em;
    line-height:1.01;
  }
  .gradText{
    background:var(--grad);
    -webkit-background-clip:text;
    background-clip:text;
    color:transparent;
    font-weight:1000;
  }
  .heroCard p{margin:10px 0 0; color:var(--muted); font-size:15.5px; line-height:1.45;}
  .heroRow{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

  .heroQuick{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(0,0,0,.14);
    padding:18px;
    display:grid;
    gap:12px;
  }
  .stat{
    border:1px solid rgba(255,255,255,.12);
    border-radius:16px;
    background: rgba(255,255,255,.04);
    padding:12px;
  }
  .stat .k{color:var(--muted2); font-weight:1000; font-size:11px; letter-spacing:.12em; text-transform:uppercase;}
  .stat .v{margin-top:8px; font-weight:1000; letter-spacing:-.02em; font-size: 20px;}
  .stat .v span{ color: var(--utility); }
  .stat .sub{margin-top:6px; color:var(--muted); font-weight:900; font-size: 13px; line-height:1.35;}

  /* Cards with safe image sizing */
  .card, .linkCard{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(0,0,0,.14);
    overflow:hidden;
  }
  .card img, .linkCard img{
    width:100%;
    height: min(52vh, 520px);
    object-fit: contain;
    display:block;
    background:#000;
    cursor:pointer;
  }
  .cap, .linkCap{
    padding:12px 14px;
    border-top:1px solid rgba(255,255,255,.10);
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    background: rgba(0,0,0,.12);
    font-weight:1000;
  }
  .cap small, .linkCap small{color:var(--muted2); font-weight:900; white-space:nowrap;}

  .rateBox{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(0,0,0,.14);
    padding:16px;
  }
  .rateBox .k{color:var(--muted2); font-weight:1000; font-size:11px; letter-spacing:.12em; text-transform:uppercase;}
  .rateBox .v{margin-top:10px; font-weight:1000; font-size: clamp(24px, 3.2vw, 44px); letter-spacing:-.04em;}
  .rateBox .delta{margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  .rateBox .delta strong{
    color:#07121b;background:var(--grad);
    border-radius:999px;padding:8px 10px;font-weight:1000;
  }
  .muted{color:var(--muted)}

  /* Compare */
  .compareTop{display:grid; grid-template-columns: repeat(3,1fr); gap:12px;}
  @media (max-width:980px){ .compareTop{grid-template-columns:1fr;} }
  .col{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    background: rgba(255,255,255,.04);
    overflow:hidden;
  }
  .colHead{
    padding:12px 14px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.05);
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
  }
  .colHead .label{color:var(--muted2); font-weight:1000; font-size:11px; letter-spacing:.12em; text-transform:uppercase;}
  .colHead .title{margin-top:2px; font-weight:1000; font-size:18px; letter-spacing:-.02em;}
  .tag{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:6px 10px;
    font-weight:950;
    font-size:12px;
    color: rgba(255,255,255,.86);
    white-space:nowrap;
  }
  .colBody{padding:14px; display:grid; gap:10px;}
  .klabel{
    display:block;color:var(--muted2);
    font-weight:1000;font-size:11px;
    letter-spacing:.12em;text-transform:uppercase;
    margin-bottom:6px;
  }
  input{
    width:100%; padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.22);
    color: rgba(255,255,255,.96);
    font-weight:1000; font-size:16px;
    outline:none; min-height:44px;
  }

  .metric{
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.14);
    border-radius:14px;
    padding:10px 12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .metric .mk{color:var(--muted2); font-weight:950; font-size:11px; letter-spacing:.12em; text-transform:uppercase;}
  .metric .mv{font-weight:1000; font-size:18px;}

  /* Year wheel (O(1) math, iPhone-safe) */
  .yearPanel{
    margin-top:14px;
    border:1px solid rgba(255,255,255,.14);
    border-radius:22px;
    background: rgba(255,255,255,.04);
    overflow:hidden;
  }
  .yearHead{
    padding:14px 16px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.12);
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .yearHead .t{font-weight:1000; letter-spacing:-.02em; display:flex; align-items:center; gap:10px;}
  .yearPill{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:8px 10px;
    font-weight:1000;
    display:flex;
    align-items:center;
    gap:10px;
    white-space:nowrap;
  }
  .yearPill .dot2{width:10px;height:10px;border-radius:999px;background:var(--grad);}

  .yearBody{
    padding:16px;
    display:grid;
    grid-template-columns: .9fr 1.1fr;
    gap:12px;
  }
  @media (max-width:980px){ .yearBody{grid-template-columns:1fr;} }

  .wheelBox{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.14);
    border-radius:18px;
    padding:14px;
    display:grid;
    gap:12px;
  }
  .wheelTop{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;}
  .yearBig{font-size: clamp(46px, 6.6vw, 78px); font-weight:1000; letter-spacing:-.05em; line-height:1;}
  .dialBtns{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .miniBtn{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:var(--text);
    border-radius:14px;
    padding:10px 12px;
    font-weight:950;
    min-height:44px;
    cursor:pointer;
  }
  .wheel{
    position:relative;
    height:220px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    overflow:hidden;
  }
  .wheel::before{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(180deg, rgba(11,16,23,.92), transparent 28%, transparent 72%, rgba(11,16,23,.92));
    pointer-events:none;
    z-index:2;
  }
  .wheel::after{
    content:"";
    position:absolute;
    left:10px; right:10px;
    top: calc(50% - 22px);
    height:44px;
    border-radius:14px;
    border:1px solid rgba(251,201,9,.24);
    pointer-events:none;
    z-index:3;
  }
  .wheelList{
    height:100%;
    overflow-y:auto;
    scroll-snap-type:y mandatory;
    -webkit-overflow-scrolling: touch;
    padding: 88px 0; /* must match JS math */
    margin:0;
  }
  .wheelList::-webkit-scrollbar{ width:0; height:0; }
  .wheelItem{
    height:44px;
    display:flex;
    align-items:center;
    justify-content:center;
    scroll-snap-align:center;
    font-weight:1000;
    font-size:20px;
    letter-spacing:-.01em;
    color: rgba(255,255,255,.72);
    user-select:none;
  }
  .wheelItem.active{ color: rgba(255,255,255,.96); }

  .yearCompare{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.14);
    border-radius:18px;
    padding:14px;
    display:grid;
    gap:12px;
  }
  .bigMoneyGrid{display:grid; grid-template-columns: repeat(3,1fr); gap:10px;}
  @media (max-width:980px){ .bigMoneyGrid{grid-template-columns:1fr;} }
  .bigTile{
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.04);
    border-radius:18px;
    padding:12px;
  }
  .bigTile .bk{
    color:var(--muted2);
    font-weight:1000;
    font-size:11px;
    letter-spacing:.12em;
    text-transform:uppercase;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .chip{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    border-radius:999px;
    padding:6px 10px;
    font-weight:950;
    color: rgba(255,255,255,.86);
    white-space:nowrap;
    font-size:12px;
  }
  .bigTile .m{
    margin-top:10px;
    font-size: clamp(34px, 5.4vw, 58px);
    font-weight:1000;
    letter-spacing:-.035em;
    line-height:1;
  }
  .bigTile .a{margin-top:8px; color:var(--muted); font-weight:900; font-size:13px;}
  .yearSavings{
    border:1px solid rgba(52,199,89,.28);
    background: rgba(52,199,89,.10);
    border-radius:16px;
    padding:10px 12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
    font-weight:1000;
  }
  .yearSavings .v{font-size:18px; color: var(--opt1); letter-spacing:-.01em;}

  /* Video (loads on demand only) */
  .videoShell{
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    overflow:hidden;
    background: rgba(0,0,0,.18);
  }
  .poster{
    padding:16px;
    display:grid;
    gap:12px;
    background: rgba(0,0,0,.14);
  }
  .poster .pt{font-weight:1000; font-size: clamp(20px, 2.6vw, 34px); letter-spacing:-.03em;}
  .poster .ps{color:var(--muted); font-weight:900; line-height:1.45;}
  .iframeBox{
    width:100%;
    aspect-ratio: 9/16;
    max-height: 78vh;
    background:#000;
    display:none;
  }
  .iframeBox iframe{width:100%; height:100%; border:0; display:block;}

  /* Timeline */
  .timeline{display:grid; grid-template-columns: repeat(6,1fr); gap:10px;}
  @media (max-width:980px){ .timeline{grid-template-columns:1fr;} }
  .step{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.14);
    border-radius:18px;
    padding:14px;
    min-height:112px;
  }
  .num{
    width:30px;height:30px;border-radius:12px;
    background: var(--grad);
    color:#07121b;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:1000;
    margin-bottom:10px;
  }
  .step .t{font-weight:1000; letter-spacing:-.02em;}
  .step .d{margin-top:8px; color: rgba(255,255,255,.78); font-weight:900;}
</style>
</head>

<body>
<div class="topbar">
  <div class="topbarInner">
    <div class="brand">
      <img id="logoImg" alt="Logo"/>
      <div class="brandTitle">
        <div class="name"><span class="dot"></span> Leverage Our Sun</div>
        <div class="sub">Solar + Storage Closing Tool</div>
      </div>
    </div>
    <div class="nav">
      <button class="btn" id="btnHome" type="button">Home</button>
      <button class="btn" id="btnPrevTop" type="button">Prev</button>
      <button class="btn primary" id="btnNextTop" type="button">Next</button>
      <button class="btn danger" id="btnReset" type="button">Reset</button>
    </div>
  </div>
  <div class="progressWrap">
    <div class="progress"><div id="progressFill"></div></div>
  </div>
</div>

<div class="badge">
  <span class="dot"></span>
  <span class="t" id="slideCounter">Slide 1 / 1</span>
</div>

<div class="deck">
  <div class="stage" id="stage">

    <!-- SLIDE 1 -->
    <section class="slide active" data-slide>
      <div class="slideHead">
        <h2><span class="spark"></span> Closing Tool</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Win the day • Own the night</span>
        </div>
      </div>
      <div class="slideBody">
        <div class="hero">
          <div class="heroCard">
            <h1>Win the day. <span class="gradText">Own the night.</span></h1>
            <p>Show the problem, show proof, then compare payments year-by-year. Built for iPhone + laptop presentations.</p>
            <div class="heroRow">
              <button class="btn primary" type="button" onclick="go(1)">Start</button>
              <button class="btn" type="button" onclick="go(4)">Compare</button>
              <button class="btn" type="button" onclick="go(6)">Timeline</button>
            </div>
          </div>
          <div class="heroQuick">
            <div class="stat">
              <div class="k">Rates (15 years)</div>
              <div class="v"><span>$0.17</span> → <span>$0.42</span> / kWh</div>
              <div class="sub">The “when” is what changed.</div>
            </div>
            <div class="stat">
              <div class="k">Proof</div>
              <div class="v">$28 bill example</div>
              <div class="sub">Controlled peak buying.</div>
            </div>
            <div class="stat">
              <div class="k">Close</div>
              <div class="v">Year wheel</div>
              <div class="sub">Year 1 → Year 25 instantly.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 2 -->
    <section class="slide" data-slide data-hydrate="problem">
      <div class="slideHead">
        <h2><span class="spark"></span> The Problem</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Edison rates keep rising</span>
        </div>
      </div>
      <div class="slideBody">
        <div class="grid grid2">
          <div class="card">
            <img id="imgUtilityBill" alt="Utility bill without solar" />
            <div class="cap"><div>Today’s bill (no solar)</div><small>Tap to view</small></div>
          </div>
          <div class="rateBox">
            <div class="k">Rates exploded</div>
            <div class="v"><span style="color:var(--utility);">$0.17</span> → <span style="color:var(--utility);">$0.42</span> / kWh</div>
            <div class="delta"><span>≈ 15 years</span><strong>+147%</strong></div>
            <div class="muted" style="font-weight:900;font-size:13px;margin-top:10px;">TOU peak hours is where the pain is.</div>
          </div>
        </div>
        <div class="grid grid2eq" style="margin-top:16px">
          <div class="linkCard" id="thumbSCE">
            <img id="imgThumbSCE" alt="SCE bill updates thumbnail"/>
            <div class="linkCap"><span>SCE: Understanding bill updates</span><small>Open</small></div>
          </div>
          <div class="linkCard" id="thumbLAT">
            <img id="imgThumbLAT" alt="LA Times Edison rate case thumbnail"/>
            <div class="linkCap"><span>LA Times: Edison rate case</span><small>Open</small></div>
          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 3 -->
    <section class="slide" data-slide data-hydrate="proof">
      <div class="slideHead">
        <h2><span class="spark"></span> Proof</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Solar + Storage</span>
        </div>
      </div>
      <div class="slideBody">
        <div class="grid grid2">
          <div class="card">
            <img id="imgSolarBill" alt="Solar + storage bill example" />
            <div class="cap"><div>Solar + storage bill example ($28)</div><small>Tap to view</small></div>
          </div>
          <div class="rateBox">
            <div class="k">Why it can be low</div>
            <div class="v"><span class="gradText">$28</span> month example</div>
            <div class="muted" style="font-weight:900;margin-top:10px;line-height:1.45">
              Solar covers daytime usage. Batteries cover peak hours. The utility becomes a backup supplier instead of the main supplier.
              What remains is usually minimum charges + small net usage.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 4 -->
    <section class="slide" data-slide>
      <div class="slideHead">
        <h2><span class="spark"></span> Time-of-Use Strategy</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <span class="pill"><span class="dot"></span> Solar powers day • Batteries own peak</span>
        </div>
      </div>
      <div class="slideBody">
        <div class="rateBox">
          <div class="k">The core idea</div>
          <div class="v">Stop buying peak power.</div>
          <div class="muted" style="font-weight:900;margin-top:10px;line-height:1.45">
            TOU pricing is the battlefield. Produce during the day, store surplus, and discharge during peak hours.
            Same batteries that save money also provide outage backup.
          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 5 -->
    <section class="slide" data-slide>
      <div class="slideHead">
        <h2><span class="spark"></span> Compare</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button class="btn" type="button" onclick="setYear(1)">Year 1</button>
          <button class="btn" type="button" onclick="setYear(5)">Year 5</button>
          <button class="btn" type="button" onclick="setYear(10)">Year 10</button>
          <button class="btn" type="button" onclick="setYear(25)">Year 25</button>
        </div>
      </div>

      <div class="slideBody">
        <div class="compareTop">
          <div class="col">
            <div class="colHead" style="background:rgba(255,59,48,.12);">
              <div><div class="label">Utility</div><div class="title">Edison</div></div>
              <span class="tag">Red</span>
            </div>
            <div class="colBody">
              <label><span class="klabel">Avg monthly bill ($)</span><input id="uPay" inputmode="decimal" value="458"></label>
              <label><span class="klabel">Annual increase (%)</span><input id="uEsc" inputmode="decimal" value="9"></label>
              <div class="metric"><div class="mk">25-year utility spend</div><div class="mv" id="uTotal" style="color:var(--utility)">$0</div></div>
            </div>
          </div>

          <div class="col">
            <div class="colHead" style="background:rgba(52,199,89,.12);">
              <div><div class="label">Option 1</div><div class="title">Proposal A</div></div>
              <span class="tag">Green</span>
            </div>
            <div class="colBody">
              <label><span class="klabel">Avg monthly payment ($)</span><input id="aPay" inputmode="decimal" value="295"></label>
              <label><span class="klabel">Annual increase (%)</span><input id="aEsc" inputmode="decimal" value="0"></label>
              <div class="metric"><div class="mk">Total savings over 25 years</div><div class="mv" id="aSave25" style="color:var(--opt1)">$0</div></div>
            </div>
          </div>

          <div class="col">
            <div class="colHead" style="background:rgba(0,194,255,.12);">
              <div><div class="label">Option 2</div><div class="title">Proposal B</div></div>
              <span class="tag">Cyan</span>
            </div>
            <div class="colBody">
              <label><span class="klabel">Avg monthly payment ($)</span><input id="bPay" inputmode="decimal" value="325"></label>
              <label><span class="klabel">Annual increase (%)</span><input id="bEsc" inputmode="decimal" value="0"></label>
              <div class="metric"><div class="mk">Total savings over 25 years</div><div class="mv" id="bSave25" style="color:var(--opt2)">$0</div></div>
            </div>
          </div>
        </div>

        <div class="yearPanel">
          <div class="yearHead">
            <div class="t"><span class="spark"></span> Annual payment comparison (synced year)</div>
            <div class="yearPill"><span class="dot2"></span> Year <span id="yearChip">1</span></div>
          </div>

          <div class="yearBody">
            <div class="wheelBox">
              <div class="wheelTop">
                <div class="yearBig" id="yearBig">1</div>
                <div class="dialBtns">
                  <button class="miniBtn" type="button" id="yearMinus">−1</button>
                  <button class="miniBtn" type="button" id="yearPlus">+1</button>
                </div>
              </div>

              <div class="wheel">
                <div class="wheelList" id="yearWheel"></div>
              </div>

              <div class="muted" style="font-weight:900;font-size:13px;">
                Scroll wheel or tap +/−. Updates all 3 options together.
              </div>
            </div>

            <div class="yearCompare">
              <div class="bigMoneyGrid">
                <div class="bigTile">
                  <div class="bk">Utility <span class="chip">Red</span></div>
                  <div class="m" id="uM" style="color:var(--utility)">$0.00</div>
                  <div class="a" id="uY">Annual: $0</div>
                </div>

                <div class="bigTile">
                  <div class="bk">Option 1 <span class="chip">Green</span></div>
                  <div class="m" id="aM" style="color:var(--opt1)">$0.00</div>
                  <div class="a" id="aY">Annual: $0</div>
                </div>

                <div class="bigTile">
                  <div class="bk">Option 2 <span class="chip">Cyan</span></div>
                  <div class="m" id="bM" style="color:var(--opt2)">$0.00</div>
                  <div class="a" id="bY">Annual: $0</div>
                </div>
              </div>

              <div class="yearSavings">
                <div>Best option savings vs utility (annual)</div>
                <div class="v" id="bestAnnual">$0</div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </section>

    <!-- SLIDE 6 -->
    <section class="slide" data-slide>
      <div class="slideHead">
        <h2><span class="spark"></span> Tesla VPP + Outage Demo</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <a class="btn" target="_blank" rel="noreferrer" href="https://www.tesla.com/support/energy/virtual-power-plant/sce">Tesla VPP (SCE)</a>
          <a class="btn" target="_blank" rel="noreferrer" href="https://www.tesla.com/powerwall">Powerwall</a>
          <a class="btn primary" target="_blank" rel="noreferrer" href="https://www.canva.com/design/DAHAUW0lThM/7uWp2DvWgb6PSyIROmq5Rw/watch">Open Demo</a>
        </div>
      </div>

      <div class="slideBody">
        <div class="videoShell">
          <div class="poster" id="demoPoster">
            <div class="pt">Outage Demo</div>
            <div class="ps">Press <b>Load Outage Demo</b> to play here (loads only on demand to stay stable on iPhone).</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
              <button class="btn primary" type="button" id="btnLoadDemo">Load Outage Demo</button>
              <a class="btn" target="_blank" rel="noreferrer" href="https://www.canva.com/design/DAHAUW0lThM/7uWp2DvWgb6PSyIROmq5Rw/watch">Open in new tab</a>
            </div>
          </div>
          <div class="iframeBox" id="demoBox">
            <iframe id="demoFrame" loading="lazy" allowfullscreen="allowfullscreen" allow="fullscreen"></iframe>
          </div>
        </div>
      </div>
    </section>

    <!-- SLIDE 7 -->
    <section class="slide" data-slide>
      <div class="slideHead">
        <h2><span class="spark"></span> Timeline</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <a class="btn" target="_blank" rel="noreferrer" href="https://www.sunup-energy.com">sunup-energy.com</a>
          <a class="btn" target="_blank" rel="noreferrer" href="https://fulfillpower.com">fulfillpower.com</a>
          <a class="btn primary" target="_blank" rel="noreferrer"
             href="https://www.google.com/search?client=safari&hs=XBx9&sca_esv=73cfac6e472fb041&hl=en-us&sxsrf=ANbL-n5pIhFe5d5WvDJM7Q0KFrq6PCcSHA:1770166523563&si=AL3DRZEsmMGCryMMFSHJ3StBhOdZ2-6yYkXd_doETEE1OR-qOXnP5y33aL_iPZUyUpu_SzVI30rKWvofbcNHLRJ4VaxEepZ7V0Em9qWKB4eJ7S79uZ8SMddoiF83pzp_1DfpRctiz00a&q=SunUp+Energy+Reviews&sa=X&biw=1366&bih=896&dpr=2&aic=0&sei=ApmCaZe1G_aK8L0PpL7O2Ak&dlnr=1">Reviews</a>
        </div>
      </div>
      <div class="slideBody">
        <div class="timeline">
          <div class="step"><div class="num">1</div><div class="t">Site Survey</div><div class="d">&lt; 1 week</div></div>
          <div class="step"><div class="num">2</div><div class="t">Engineering</div><div class="d">1 week</div></div>
          <div class="step"><div class="num">3</div><div class="t">Permits</div><div class="d">1–12 weeks</div></div>
          <div class="step"><div class="num">4</div><div class="t">Install Schedule</div><div class="d">1 day–2 weeks</div></div>
          <div class="step"><div class="num">5</div><div class="t">Final Inspection</div><div class="d">1–2 weeks</div></div>
          <div class="step"><div class="num">6</div><div class="t">PTO + First Payment</div><div class="d">PTO 30–60 days • 1st payment 1 month after PTO</div></div>
        </div>
      </div>
    </section>

  </div>
</div>

<div class="presentBar">
  <button class="btn" id="btnPrev" type="button">Prev</button>
  <button class="btn primary" id="btnNext" type="button">Next</button>
</div>

<script>
/* ========= YOUR ASSETS ========= */
const ASSETS = {
  logo: "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/4A5B0E0C-50D9-4752-8469-F61A667110D8.png",
  utilityBill: "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_8578.jpeg",
  solarBill:   "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_9100.jpeg",
  thumbSCE: "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_9107.jpeg",
  thumbLAT: "https://raw.githubusercontent.com/solar-gang/Storage-presentation/main/IMG_9106.jpeg",
  linkSCE: "https://www.sce.com/save-money/rates-financing/residential-rate-plans/understanding-updates-to-your-bill",
  linkLAT: "https://www.latimes.com/business/story/2025-05-22/edison-general-rate-case",
  canvaEmbed: "https://www.canva.com/design/DAHAUW0lThM/7uWp2DvWgb6PSyIROmq5Rw/watch?embed"
};

const $ = (id)=>document.getElementById(id);

/* ========= SLIDES ========= */
let slides = [];
let idx = 0;
const progressFill = $("progressFill");
const slideCounter = $("slideCounter");

function refreshSlides(){ slides = Array.from(document.querySelectorAll("[data-slide]")); }
function updateHUD(){
  slideCounter.textContent = `Slide ${idx+1} / ${slides.length}`;
  const pct = (idx / Math.max(1, slides.length-1)) * 100;
  progressFill.style.width = `${pct}%`;
}

function activate(i){
  refreshSlides();
  idx = Math.max(0, Math.min(slides.length-1, i));
  slides.forEach((s, n)=> s.classList.toggle("active", n === idx));
  updateHUD();
  const b = slides[idx].querySelector(".slideBody");
  if(b) b.scrollTop = 0;
  hydrateForActiveSlide();
}
function next(){ activate(idx+1); }
function prev(){ activate(idx-1); }
function go(i){ activate(i); }
window.go = go;

$("btnNext").addEventListener("click", next);
$("btnPrev").addEventListener("click", prev);
$("btnNextTop").addEventListener("click", next);
$("btnPrevTop").addEventListener("click", prev);
$("btnHome").addEventListener("click", ()=>activate(0));

document.addEventListener("keydown", (e)=>{
  if(e.key === "ArrowRight" || e.key === " " || e.key === "PageDown"){ e.preventDefault(); next(); }
  if(e.key === "ArrowLeft"  || e.key === "PageUp"){ e.preventDefault(); prev(); }
  if(e.key === "Home"){ e.preventDefault(); activate(0); }
  if(e.key === "End"){ e.preventDefault(); activate(slides.length-1); }
});

/* ========= POPUP FOR LINKS ========= */
function popupArticle(url){
  const w = Math.min(1100, screen.width * 0.92);
  const h = Math.min(820, screen.height * 0.88);
  const left = (screen.width - w) / 2;
  const top = (screen.height - h) / 2;
  const win = window.open(url, "LOS_ARTICLE",
    `popup=yes,scrollbars=yes,resizable=yes,width=${w},height=${h},left=${left},top=${top}`
  );
  if(win) win.focus(); else window.location.href = url;
}

/* ========= HYDRATION (ONLY LOAD WHEN NEEDED) ========= */
const hydrated = { logo:false, problem:false, proof:false, thumbs:false, wheel:false };

function hydrateForActiveSlide(){
  if(!hydrated.logo){
    const img = $("logoImg");
    img.loading="eager"; img.decoding="async";
    img.src = ASSETS.logo;
    hydrated.logo = true;
  }

  const active = slides[idx];
  const tag = active.getAttribute("data-hydrate") || "";

  if(tag === "problem" && !hydrated.problem){
    const u = $("imgUtilityBill");
    // load only on slide open (still stable)
    u.loading="lazy"; u.decoding="async"; u.src = ASSETS.utilityBill;
    u.onclick = ()=>window.open(ASSETS.utilityBill, "_blank", "noopener,noreferrer");

    $("imgThumbSCE").loading="lazy"; $("imgThumbSCE").decoding="async"; $("imgThumbSCE").src = ASSETS.thumbSCE;
    $("imgThumbLAT").loading="lazy"; $("imgThumbLAT").decoding="async"; $("imgThumbLAT").src = ASSETS.thumbLAT;
    $("thumbSCE").onclick = ()=>popupArticle(ASSETS.linkSCE);
    $("thumbLAT").onclick = ()=>popupArticle(ASSETS.linkLAT);

    hydrated.problem = true;
  }

  if(tag === "proof" && !hydrated.proof){
    const s = $("imgSolarBill");
    s.loading="lazy"; s.decoding="async"; s.src = ASSETS.solarBill;
    s.onclick = ()=>window.open(ASSETS.solarBill, "_blank", "noopener,noreferrer");
    hydrated.proof = true;
  }

  if(idx === 4 && !hydrated.wheel){
    buildYearWheel();
    hydrated.wheel = true;
  }
}

/* ========= CALCULATOR + YEAR WHEEL ========= */
let year = 1;
let cache = { u:[], a:[], b:[], uTotal:0, aTotal:0, bTotal:0 };

function toNumber(v){
  const n = parseFloat(String(v).replace(/[^0-9.\-]/g,""));
  return Number.isFinite(n) ? n : 0;
}
function money0(n){ return (Number.isFinite(n)?n:0).toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0}); }
function money2(n){ return (Number.isFinite(n)?n:0).toLocaleString(undefined,{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}); }

function monthlySeries(baseMonthly, escPct, years=25){
  const r = escPct/100;
  const out = [];
  for(let y=1;y<=years;y++) out.push(baseMonthly * Math.pow(1+r, y-1));
  return out;
}
function totalSeries(series){ return series.reduce((s,m)=> s + (m*12), 0); }

function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

function recalc(){
  const uPay = toNumber($("uPay").value);
  const uEsc = toNumber($("uEsc").value);
  const aPay = toNumber($("aPay").value);
  const aEsc = toNumber($("aEsc").value);
  const bPay = toNumber($("bPay").value);
  const bEsc = toNumber($("bEsc").value);

  cache.u = monthlySeries(uPay, uEsc);
  cache.a = monthlySeries(aPay, aEsc);
  cache.b = monthlySeries(bPay, bEsc);

  cache.uTotal = totalSeries(cache.u);
  cache.aTotal = totalSeries(cache.a);
  cache.bTotal = totalSeries(cache.b);

  $("uTotal").textContent = money0(cache.uTotal);
  $("aSave25").textContent = money0(cache.uTotal - cache.aTotal);
  $("bSave25").textContent = money0(cache.uTotal - cache.bTotal);

  setYear(year, true);
}

function setYear(newYear, snapWheel){
  year = clamp(parseInt(newYear,10)||1, 1, 25);
  $("yearBig").textContent = String(year);
  $("yearChip").textContent = String(year);

  const i = year - 1;
  const uM = cache.u[i] || 0;
  const aM = cache.a[i] || 0;
  const bM = cache.b[i] || 0;

  $("uM").textContent = money2(uM);
  $("aM").textContent = money2(aM);
  $("bM").textContent = money2(bM);

  $("uY").textContent = `Annual: ${money0(uM*12)}`;
  $("aY").textContent = `Annual: ${money0(aM*12)}`;
  $("bY").textContent = `Annual: ${money0(bM*12)}`;

  const best = Math.min(aM, bM);
  const bestAnnual = (uM - best) * 12;
  $("bestAnnual").textContent = money0(bestAnnual);
  $("bestAnnual").style.color = (bestAnnual >= 0) ? "var(--opt1)" : "var(--utility)";

  const wheel = $("yearWheel");
  if(wheel){
    const items = wheel.querySelectorAll(".wheelItem");
    items.forEach((el, idx)=> el.classList.toggle("active", idx === i));
    if(snapWheel){
      const target = items[i];
      if(target){
        const top = target.offsetTop - (wheel.clientHeight/2 - target.clientHeight/2);
        wheel.scrollTo({ top, behavior: "auto" }); /* iPhone-safe */
      }
    }
  }
}
window.setYear = setYear;

function buildYearWheel(){
  const wheel = $("yearWheel");
  wheel.innerHTML = "";
  for(let y=1;y<=25;y++){
    const div = document.createElement("div");
    div.className = "wheelItem" + (y===1 ? " active" : "");
    div.textContent = `Year ${y}`;
    div.addEventListener("click", ()=>setYear(y, true));
    wheel.appendChild(div);
  }

  // O(1) year calc based on fixed sizes
  const ITEM_H = 44;
  const PAD = 88; // must match CSS padding on .wheelList

  let ticking = false;
  wheel.addEventListener("scroll", ()=>{
    if(ticking) return;
    ticking = true;
    requestAnimationFrame(()=>{
      ticking = false;
      // center line inside wheel list
      const center = wheel.scrollTop + (wheel.clientHeight/2);
      // remove padding and align to item centers
      const pos = center - PAD - (ITEM_H/2);
      const idx = clamp(Math.round(pos / ITEM_H), 0, 24);
      const newYear = idx + 1;
      if(newYear !== year) setYear(newYear, false);
    });
  }, {passive:true});

  $("yearMinus").onclick = ()=>setYear(year-1, true);
  $("yearPlus").onclick  = ()=>setYear(year+1, true);

  ["uPay","uEsc","aPay","aEsc","bPay","bEsc"].forEach(id=>{
    const el = $(id);
    if(el && !el.dataset.bound){
      el.dataset.bound = "1";
      el.addEventListener("input", recalc);
    }
  });

  recalc();
  setYear(1, true);
}

/* ========= VIDEO (LOAD ONLY WHEN BUTTON PRESSED) ========= */
$("btnLoadDemo").addEventListener("click", ()=>{
  const poster = $("demoPoster");
  const box = $("demoBox");
  const frame = $("demoFrame");
  if(frame && !frame.src){
    if(poster) poster.style.display = "none";
    if(box) box.style.display = "block";
    frame.src = ASSETS.canvaEmbed;
  }
});

/* ========= RESET ========= */
$("btnReset").addEventListener("click", ()=>{
  $("uPay").value="458"; $("uEsc").value="9";
  $("aPay").value="295"; $("aEsc").value="0";
  $("bPay").value="325"; $("bEsc").value="0";
  year = 1;
  if(cache.u.length) recalc();
  activate(0);
});

/* ========= STARTUP ========= */
(function init(){
  refreshSlides();
  activate(0);
})();
</script>
</body>
</html>
